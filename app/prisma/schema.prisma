generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/cfo_budgeting_app/app/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// NextAuth.js required models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  firstName     String?
  lastName      String?
  companyName   String?
  jobTitle      String?
  phone         String?
  address       String?
  city          String?
  state         String?
  country       String?
  zipCode       String?
  businessType  BusinessType @default(SMALL_BUSINESS)
  industry      String?
  annualRevenue Float?
  companySize   CompanySize @default(SMALL)
  fiscalYearEnd DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts           Account[]
  sessions           Session[]
  transactions       Transaction[]
  categories         Category[]
  debts              Debt[]
  goals              Goal[]
  budgets            Budget[]
  notifications      Notification[]
  csvUploads         CsvUpload[]
  bankStatements     BankStatement[]
  financialMetrics   FinancialMetrics?
  
  // Business entities
  customers          Customer[]
  vendors            Vendor[]
  contractors        Contractor[]
  products           Product[]
  services           Service[]
  invoices           Invoice[]
  estimates          Estimate[]
  projects           Project[]
  employees          Employee[]
  tasks              Task[]
  documents          Document[]
  bills              Bill[]
  expenseClaims      ExpenseClaim[]
  receipts           Receipt[]
  automations        Automation[]
  chartOfAccounts    ChartOfAccount[]
  journalEntries     JournalEntry[]
  reconciliations    Reconciliation[]

  // Advanced Financial Features
  cashFlowForecasts  CashFlowForecast[]
  taxOptimizations   TaxOptimization[]
  businessInsights   BusinessInsight[]
  aiRecommendations  AIRecommendation[]
  scenarioAnalyses   ScenarioAnalysis[]
  complianceTracking ComplianceTracking[]
  creditApplications CreditApplication[]
  industryBenchmarks IndustryBenchmark[]
  predictiveModels   PredictiveModel[]
  businessEntities   BusinessEntity[]
  workflowRules      WorkflowRule[]
  kpiTargets         KPITarget[]
  budgetScenarios    BudgetScenario[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// Core Financial Models
model Transaction {
  id            String   @id @default(cuid())
  userId        String
  date          DateTime
  amount        Float
  description   String
  merchant      String?
  category      String
  categoryId    String?
  vendorId      String?
  type          TransactionType // INCOME, EXPENSE, TRANSFER
  account       String?
  csvUploadId   String?
  bankStatementId String?
  isRecurring   Boolean  @default(false)
  aiCategorized Boolean  @default(false) // Indicates if AI categorized this
  confidence    Float?   // AI confidence score (0-1)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  categoryRelation Category?   @relation(fields: [categoryId], references: [id])
  csvUpload     CsvUpload?     @relation(fields: [csvUploadId], references: [id])
  bankStatement BankStatement? @relation(fields: [bankStatementId], references: [id])
  vendor        Vendor?        @relation(fields: [vendorId], references: [id])

  @@index([userId, date])
  @@index([userId, category])
}

model Category {
  id          String   @id @default(cuid())
  userId      String
  name        String
  color       String   @default("#3B82F6")
  icon        String   @default("folder")
  budget      Float?
  type        CategoryType // EXPENSE, INCOME
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@unique([userId, name])
}

model Debt {
  id            String   @id @default(cuid())
  userId        String
  name          String
  balance       Float
  interestRate  Float
  minimumPayment Float
  dueDate       Int      // Day of month (1-31)
  type          DebtType // CREDIT_CARD, STUDENT_LOAN, MORTGAGE, PERSONAL_LOAN, OTHER
  priority      Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments DebtPayment[]

  @@index([userId, isActive])
}

model DebtPayment {
  id        String   @id @default(cuid())
  debtId    String
  amount    Float
  date      DateTime
  principal Float?
  interest  Float?
  createdAt DateTime @default(now())

  debt Debt @relation(fields: [debtId], references: [id], onDelete: Cascade)

  @@index([debtId, date])
}

model Goal {
  id           String   @id @default(cuid())
  userId       String
  name         String
  description  String?
  targetAmount Float
  currentAmount Float   @default(0)
  targetDate   DateTime?
  type         GoalType // EMERGENCY_FUND, DEBT_PAYOFF, SAVINGS, INVESTMENT, OTHER
  priority     Int      @default(0)
  isCompleted  Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isCompleted])
}

model Budget {
  id        String     @id @default(cuid())
  userId    String
  name      String
  month     Int        // 1-12
  year      Int
  amount    Float
  spent     Float      @default(0)
  category  String
  type      BudgetType // MONTHLY, WEEKLY, YEARLY
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category, month, year])
  @@index([userId, month, year])
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType // BILL_REMINDER, BUDGET_ALERT, GOAL_PROGRESS, DEBT_REMINDER, OTHER
  title     String
  message   String
  isRead    Boolean          @default(false)
  isActive  Boolean          @default(true)
  dueDate   DateTime?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@index([userId, dueDate])
}

model CsvUpload {
  id            String   @id @default(cuid())
  userId        String
  fileName      String
  originalName  String
  cloudStoragePath String
  recordCount   Int      @default(0)
  processedCount Int     @default(0)
  status        UploadStatus // PENDING, PROCESSING, COMPLETED, FAILED
  mappingConfig Json?    // Column mapping configuration
  errorLog      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@index([userId, status])
}

model BankStatement {
  id               String              @id @default(cuid())
  userId           String
  fileName         String
  originalName     String
  cloudStoragePath String
  fileType         StatementFileType   // CSV, PDF
  fileSize         Int?
  sourceType       StatementSourceType @default(BANK) // BANK, CREDIT_CARD
  bankName         String?
  accountType      String?
  accountNumber    String?             // Last 4 digits only for security
  creditLimit      Float?              // For credit card statements
  statementPeriod  String?             // e.g., "2024-01-01 to 2024-01-31"
  status           UploadStatus        @default(PENDING)
  processingStage  ProcessingStage     @default(UPLOADED)
  recordCount      Int                 @default(0)
  processedCount   Int                 @default(0)
  errorLog         String?
  aiAnalysis       Json?               // AI insights and recommendations
  extractedData    Json?               // Raw extracted data
  mappingConfig    Json?               // Column mapping for CSV
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt

  user             User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions     Transaction[]

  @@index([userId, status])
  @@index([userId, processingStage])
  @@index([userId, sourceType])
}

model FinancialMetrics {
  id                String   @id @default(cuid())
  userId            String   @unique
  monthlyIncome     Float?
  monthlyExpenses   Float?
  monthlyBurnRate   Float?
  totalDebt         Float?   @default(0)
  totalAssets       Float?   @default(0)
  netWorth          Float?
  emergencyFundGoal Float?
  debtToIncomeRatio Float?
  profitMargin      Float?
  workingCapital    Float?
  currentRatio      Float?
  quickRatio        Float?
  debtToEquityRatio Float?
  returnOnAssets    Float?
  returnOnEquity    Float?
  grossMargin       Float?
  operatingMargin   Float?
  cashFlowFromOps   Float?
  freeCashFlow      Float?
  businessCreditScore Int?
  riskScore         Float?
  lastCalculated    DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Business Models
model Customer {
  id          String   @id @default(cuid())
  userId      String
  name        String
  email       String?
  phone       String?
  address     String?
  city        String?
  state       String?
  country     String?
  zipCode     String?
  taxId       String?
  website     String?
  notes       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoices    Invoice[]
  estimates   Estimate[]
  projects    Project[]

  @@index([userId, isActive])
}

model Vendor {
  id          String   @id @default(cuid())
  userId      String
  name        String
  email       String?
  phone       String?
  address     String?
  city        String?
  state       String?
  country     String?
  zipCode     String?
  taxId       String?
  website     String?
  notes       String?
  paymentTerms String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  bills       Bill[]
  expenses    Transaction[]

  @@index([userId, isActive])
}

model Contractor {
  id          String   @id @default(cuid())
  userId      String
  name        String
  email       String?
  phone       String?
  address     String?
  city        String?
  state       String?
  country     String?
  zipCode     String?
  taxId       String?
  rate        Float?
  rateType    RateType @default(HOURLY) // HOURLY, DAILY, PROJECT
  specialty   String?
  notes       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects    Project[]
  tasks       Task[]

  @@index([userId, isActive])
}

model Product {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  sku         String?
  price       Float
  cost        Float?
  category    String?
  unit        String?
  taxable     Boolean  @default(true)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoiceItems InvoiceItem[]
  estimateItems EstimateItem[]

  @@index([userId, isActive])
  @@index([userId, category])
}

model Service {
  id          String   @id @default(cuid())
  userId      String
  name        String
  description String?
  rate        Float
  unit        String   @default("hour") // hour, day, project
  category    String?
  taxable     Boolean  @default(true)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoiceItems InvoiceItem[]
  estimateItems EstimateItem[]

  @@index([userId, isActive])
  @@index([userId, category])
}

model Invoice {
  id           String        @id @default(cuid())
  userId       String
  customerId   String
  invoiceNumber String       @unique
  title        String?
  description  String?
  issueDate    DateTime
  dueDate      DateTime
  subtotal     Float
  taxRate      Float         @default(0)
  taxAmount    Float         @default(0)
  total        Float
  amountPaid   Float         @default(0)
  status       InvoiceStatus @default(DRAFT)
  terms        String?
  notes        String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  customer     Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  items        InvoiceItem[]
  payments     Payment[]

  @@index([userId, status])
  @@index([userId, dueDate])
}

model InvoiceItem {
  id          String  @id @default(cuid())
  invoiceId   String
  productId   String?
  serviceId   String?
  description String
  quantity    Float
  rate        Float
  amount      Float
  createdAt   DateTime @default(now())

  invoice Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product Product? @relation(fields: [productId], references: [id])
  service Service? @relation(fields: [serviceId], references: [id])
}

model Estimate {
  id           String         @id @default(cuid())
  userId       String
  customerId   String
  estimateNumber String       @unique
  title        String?
  description  String?
  issueDate    DateTime
  expiryDate   DateTime?
  subtotal     Float
  taxRate      Float          @default(0)
  taxAmount    Float          @default(0)
  total        Float
  status       EstimateStatus @default(DRAFT)
  terms        String?
  notes        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  customer     Customer       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  items        EstimateItem[]

  @@index([userId, status])
  @@index([userId, expiryDate])
}

model EstimateItem {
  id          String  @id @default(cuid())
  estimateId  String
  productId   String?
  serviceId   String?
  description String
  quantity    Float
  rate        Float
  amount      Float
  createdAt   DateTime @default(now())

  estimate Estimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  product  Product? @relation(fields: [productId], references: [id])
  service  Service? @relation(fields: [serviceId], references: [id])
}

model Project {
  id          String        @id @default(cuid())
  userId      String
  customerId  String?
  contractorId String?
  name        String
  description String?
  startDate   DateTime?
  endDate     DateTime?
  budget      Float?
  status      ProjectStatus @default(PLANNING)
  priority    Priority      @default(MEDIUM)
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  customer    Customer?   @relation(fields: [customerId], references: [id])
  contractor  Contractor? @relation(fields: [contractorId], references: [id])
  tasks       Task[]
  documents   Document[]

  @@index([userId, status])
}

model Employee {
  id          String   @id @default(cuid())
  userId      String
  firstName   String
  lastName    String
  email       String
  phone       String?
  address     String?
  city        String?
  state       String?
  country     String?
  zipCode     String?
  ssn         String?
  hireDate    DateTime
  salary      Float?
  hourlyRate  Float?
  jobTitle    String?
  department  String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  paychecks   Paycheck[]
  timesheets  Timesheet[]

  @@index([userId, isActive])
}

model Paycheck {
  id          String   @id @default(cuid())
  employeeId  String
  payPeriodStart DateTime
  payPeriodEnd DateTime
  grossPay    Float
  netPay      Float
  taxes       Float
  deductions  Float
  createdAt   DateTime @default(now())

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model Timesheet {
  id         String   @id @default(cuid())
  employeeId String
  date       DateTime
  hoursWorked Float
  description String?
  approved   Boolean  @default(false)
  createdAt  DateTime @default(now())

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model Task {
  id           String     @id @default(cuid())
  userId       String
  projectId    String?
  contractorId String?
  title        String
  description  String?
  priority     Priority   @default(MEDIUM)
  status       TaskStatus @default(TODO)
  dueDate      DateTime?
  completedAt  DateTime?
  estimatedHours Float?
  actualHours    Float?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  project    Project?    @relation(fields: [projectId], references: [id])
  contractor Contractor? @relation(fields: [contractorId], references: [id])

  @@index([userId, status])
  @@index([userId, dueDate])
}

model Document {
  id              String       @id @default(cuid())
  userId          String
  projectId       String?
  name            String
  description     String?
  fileName        String
  cloudStoragePath String
  fileSize        Int?
  mimeType        String?
  category        DocumentCategory @default(OTHER)
  isPublic        Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id])

  @@index([userId, category])
}

model Bill {
  id          String     @id @default(cuid())
  userId      String
  vendorId    String?
  billNumber  String?
  description String
  amount      Float
  dueDate     DateTime
  paidDate    DateTime?
  status      BillStatus @default(PENDING)
  category    String?
  notes       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  vendor Vendor? @relation(fields: [vendorId], references: [id])

  @@index([userId, status])
  @@index([userId, dueDate])
}

model ExpenseClaim {
  id          String            @id @default(cuid())
  userId      String
  title       String
  description String?
  amount      Float
  date        DateTime
  category    String?
  status      ExpenseClaimStatus @default(SUBMITTED)
  receiptPath String?
  notes       String?
  approvedAt  DateTime?
  paidAt      DateTime?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, date])
}

model Receipt {
  id              String   @id @default(cuid())
  userId          String
  vendor          String?
  amount          Float
  date            DateTime
  category        String?
  description     String?
  cloudStoragePath String?
  ocrText         String?
  ocrData         Json?    // Structured OCR data
  aiAnalysis      Json?    // AI insights from receipt
  processed       Boolean  @default(false)
  confidence      Float?   // OCR confidence score
  taxDeductible   Boolean  @default(false)
  businessExpense Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([userId, processed])
  @@index([userId, taxDeductible])
}

model Automation {
  id          String          @id @default(cuid())
  userId      String
  name        String
  description String?
  trigger     AutomationTrigger
  action      AutomationAction
  conditions  Json?
  isActive    Boolean         @default(true)
  lastRun     DateTime?
  runCount    Int             @default(0)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
}

model ChartOfAccount {
  id          String      @id @default(cuid())
  userId      String
  code        String
  name        String
  type        AccountType
  parentId    String?
  description String?
  balance     Float       @default(0)
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent         ChartOfAccount?  @relation("AccountHierarchy", fields: [parentId], references: [id])
  children       ChartOfAccount[] @relation("AccountHierarchy")
  journalEntries JournalEntryLine[]

  @@unique([userId, code])
  @@index([userId, type])
}

model JournalEntry {
  id          String   @id @default(cuid())
  userId      String
  entryNumber String
  date        DateTime
  description String
  reference   String?
  totalDebit  Float
  totalCredit Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user  User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  lines JournalEntryLine[]

  @@unique([userId, entryNumber])
  @@index([userId, date])
}

model JournalEntryLine {
  id              String  @id @default(cuid())
  journalEntryId  String
  accountId       String
  description     String?
  debitAmount     Float   @default(0)
  creditAmount    Float   @default(0)

  journalEntry JournalEntry   @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
  account      ChartOfAccount @relation(fields: [accountId], references: [id])
}

model Reconciliation {
  id              String              @id @default(cuid())
  userId          String
  accountId       String?
  month           Int
  year            Int
  openingBalance  Float
  closingBalance  Float
  bankBalance     Float?
  status          ReconciliationStatus @default(PENDING)
  difference      Float               @default(0)
  notes           String?
  reconciledAt    DateTime?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, month, year])
  @@index([userId, status])
}

model Payment {
  id        String      @id @default(cuid())
  invoiceId String
  amount    Float
  date      DateTime
  method    PaymentMethod @default(BANK_TRANSFER)
  reference String?
  notes     String?
  createdAt DateTime    @default(now())

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

// Advanced Financial Features

model CashFlowForecast {
  id          String   @id @default(cuid())
  userId      String
  period      String   // "2024-Q1", "2024-01", etc.
  periodType  ForecastPeriod
  startDate   DateTime
  endDate     DateTime
  
  // Forecasted amounts
  projectedIncome    Float @default(0)
  projectedExpenses  Float @default(0)
  projectedCashFlow  Float @default(0)
  openingBalance     Float @default(0)
  closingBalance     Float @default(0)
  
  // Confidence and scenarios
  confidence         Float    @default(0.5)
  scenarioType       ScenarioType @default(REALISTIC)
  
  // Breakdown data
  incomeBreakdown    Json?    // Category-wise income projections
  expenseBreakdown   Json?    // Category-wise expense projections
  
  // Metadata
  modelVersion       String?
  generatedAt        DateTime @default(now())
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, period, scenarioType])
  @@index([userId, startDate])
  @@index([userId, scenarioType])
}

model TaxOptimization {
  id              String   @id @default(cuid())
  userId          String
  taxYear         Int
  quarter         Int?     // 1,2,3,4 for quarterly estimates
  
  // Tax calculations
  estimatedTaxableIncome Float @default(0)
  estimatedTaxLiability  Float @default(0)
  currentTaxPaid         Float @default(0)
  quarterlyEstimate      Float @default(0)
  
  // Deductions and credits
  standardDeduction      Float @default(0)
  itemizedDeductions     Json? // Breakdown by category
  businessDeductions     Json? // Business-specific deductions
  availableCredits       Json? // Tax credits
  
  // Optimization suggestions
  recommendations        Json? // AI-generated recommendations
  potentialSavings       Float @default(0)
  implementationSteps    Json? // Action items
  
  // Compliance tracking
  documentsRequired      Json? // List of required documents
  deadlines             Json? // Important tax deadlines
  filingStatus          TaxFilingStatus?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, taxYear, quarter])
  @@index([userId, taxYear])
}

model BusinessInsight {
  id          String      @id @default(cuid())
  userId      String
  type        InsightType
  category    InsightCategory
  title       String
  description String
  
  // Insight data
  value       Float?
  percentage  Float?
  trend       Trend?
  timeframe   String?     // "last_30_days", "MTD", "YTD", etc.
  
  // Context and analysis
  context     Json?       // Supporting data and context
  analysis    String?     // AI analysis explanation
  confidence  Float       @default(0.5)
  
  // Action items
  actionable  Boolean     @default(false)
  priority    Priority    @default(MEDIUM)
  suggestions Json?       // Specific action suggestions
  
  // Metadata
  source      String?     // Data source or model that generated this
  isStale     Boolean     @default(false)
  staleAt     DateTime?
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type])
  @@index([userId, priority])
  @@index([userId, actionable])
}

model AIRecommendation {
  id              String      @id @default(cuid())
  userId          String
  type            RecommendationType
  category        RecommendationCategory
  title           String
  description     String
  
  // Impact analysis
  impactLevel     ImpactLevel
  potentialSavings Float?
  potentialRevenue Float?
  riskLevel       RiskLevel   @default(LOW)
  timeToImplement String?     // "1 week", "1 month", etc.
  
  // Implementation
  steps           Json        // Step-by-step implementation guide
  requirements    Json?       // Prerequisites or requirements
  resources       Json?       // Needed resources
  
  // Status tracking
  status          RecommendationStatus @default(PENDING)
  implementedAt   DateTime?
  rejectedAt      DateTime?
  rejectionReason String?
  
  // Validation
  confidence      Float       @default(0.5)
  dataSupporting  Json?       // Supporting data and analysis
  
  // Priority and urgency
  priority        Priority    @default(MEDIUM)
  urgencyLevel    UrgencyLevel @default(NORMAL)
  dueDate         DateTime?
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, priority])
  @@index([userId, urgencyLevel])
}

model ScenarioAnalysis {
  id              String       @id @default(cuid())
  userId          String
  name            String
  description     String?
  scenarioType    ScenarioType @default(REALISTIC)
  
  // Scenario parameters
  timeHorizon     String       // "3_months", "1_year", "3_years"
  startDate       DateTime
  endDate         DateTime
  
  // Base assumptions
  revenueGrowth   Float?       // % growth rate
  expenseGrowth   Float?       // % growth rate
  inflationRate   Float?       // Expected inflation
  customVariables Json?        // Custom scenario variables
  
  // Results
  projectedRevenue   Float?
  projectedExpenses  Float?
  projectedProfit    Float?
  projectedCashFlow  Float?
  breakEvenPoint     DateTime?
  
  // Analysis
  riskFactors        Json?    // Identified risks
  opportunities      Json?    // Identified opportunities  
  recommendations    Json?    // Scenario-specific recommendations
  
  // Comparison with other scenarios
  comparisonData     Json?    // Comparison metrics
  
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, scenarioType])
  @@index([userId, startDate])
}

model ComplianceTracking {
  id              String          @id @default(cuid())
  userId          String
  complianceType  ComplianceType
  title           String
  description     String?
  
  // Requirements
  requirements    Json            // List of compliance requirements
  regulations     Json?           // Applicable regulations
  industry        String?         // Industry-specific compliance
  
  // Status tracking
  status          ComplianceStatus @default(PENDING)
  completedItems  Json?           // Completed compliance items
  pendingItems    Json?           // Pending items
  overdue         Boolean         @default(false)
  
  // Deadlines
  dueDate         DateTime?
  lastReviewDate  DateTime?
  nextReviewDate  DateTime?
  frequency       ComplianceFrequency?
  
  // Documentation
  documents       Json?           // Required/submitted documents
  evidence        Json?           // Evidence of compliance
  notes           String?
  
  // Risk assessment
  riskLevel       RiskLevel       @default(LOW)
  penalties       Json?           // Potential penalties for non-compliance
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, dueDate])
  @@index([userId, complianceType])
}

model CreditApplication {
  id                String           @id @default(cuid())
  userId            String
  type              CreditType
  lender            String?
  productName       String?
  
  // Application details
  requestedAmount   Float
  purpose           String
  termLength        Int?             // in months
  collateral        String?
  
  // Business information
  businessRevenue   Float?
  businessExpenses  Float?
  businessAge       Int?             // in months
  
  // Status tracking
  status            ApplicationStatus @default(DRAFT)
  applicationDate   DateTime?
  approvalDate      DateTime?
  decisionAmount    Float?
  interestRate      Float?
  
  // Requirements and documents
  requirements      Json?            // Required documents/info
  submittedDocs     Json?            // Submitted documentation
  
  // Analysis and recommendations
  eligibilityScore  Float?           // 0-1 score
  recommendations   Json?            // Improvement suggestions
  alternativeOptions Json?           // Alternative financing options
  
  notes             String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt

  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, type])
}

model IndustryBenchmark {
  id              String   @id @default(cuid())
  userId          String
  industry        String
  companySize     CompanySize
  region          String?
  
  // Financial benchmarks
  avgRevenue      Float?
  avgProfit       Float?
  avgExpenses     Float?
  
  // Ratios benchmarks
  avgProfitMargin Float?
  avgCurrentRatio Float?
  avgDebtToEquity Float?
  avgROA          Float?
  avgROE          Float?
  
  // Operational benchmarks
  avgEmployees    Int?
  avgCustomers    Int?
  avgProjects     Int?
  
  // Performance metrics
  revenueGrowth   Float?
  customerGrowth  Float?
  marketShare     Float?
  
  // Comparison with user
  userPerformance Json?    // How user compares to benchmarks
  gaps            Json?    // Areas for improvement
  strengths       Json?    // User's strengths vs industry
  
  // Data source and validity
  dataSource      String?
  dataDate        DateTime
  isActive        Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, industry, companySize])
  @@index([userId, industry])
}

model PredictiveModel {
  id              String      @id @default(cuid())
  userId          String
  modelType       ModelType
  name            String
  description     String?
  
  // Model configuration
  features        Json        // Input features used
  parameters      Json        // Model parameters
  algorithm       String?     // ML algorithm used
  
  // Training data
  trainingData    Json?       // Training dataset info
  trainingPeriod  String?     // Period of training data
  dataQuality     Float?      // Data quality score
  
  // Model performance
  accuracy        Float?      // Model accuracy
  precision       Float?      // Precision score
  recall          Float?      // Recall score
  lastTrained     DateTime?
  
  // Predictions
  predictions     Json?       // Current predictions
  confidenceLevel Float?      // Overall confidence
  
  // Metadata
  version         String      @default("1.0")
  isActive        Boolean     @default(true)
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, modelType])
  @@index([userId, isActive])
}

model BusinessEntity {
  id              String           @id @default(cuid())
  userId          String
  name            String
  type            EntityType
  
  // Registration details
  registrationNumber String?
  taxId           String?
  registrationDate DateTime?
  registrationState String?
  
  // Contact information
  address         String?
  city            String?
  state           String?
  country         String?
  zipCode         String?
  phone           String?
  email           String?
  
  // Financial details
  annualRevenue   Float?
  employees       Int?
  fiscalYearEnd   DateTime?
  
  // Relationships
  parentEntityId  String?
  isActive        Boolean          @default(true)
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  parentEntity    BusinessEntity?  @relation("EntityHierarchy", fields: [parentEntityId], references: [id])
  childEntities   BusinessEntity[] @relation("EntityHierarchy")

  @@index([userId, type])
  @@index([userId, isActive])
}

model WorkflowRule {
  id          String          @id @default(cuid())
  userId      String
  name        String
  description String?
  
  // Rule configuration
  trigger     WorkflowTrigger
  conditions  Json            // Trigger conditions
  actions     Json            // Actions to perform
  
  // Execution
  isActive    Boolean         @default(true)
  lastRun     DateTime?
  runCount    Int             @default(0)
  successCount Int            @default(0)
  
  // Schedule (for scheduled triggers)
  schedule    String?         // Cron expression
  nextRun     DateTime?
  
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([userId, trigger])
}

model KPITarget {
  id          String      @id @default(cuid())
  userId      String
  name        String
  description String?
  kpiType     KPIType
  
  // Target configuration
  targetValue Float
  currentValue Float       @default(0)
  unit        String?      // "$", "%", "count", etc.
  
  // Time tracking
  period      String       // "monthly", "quarterly", "yearly"
  startDate   DateTime
  endDate     DateTime
  
  // Status
  status      TargetStatus @default(IN_PROGRESS)
  progress    Float        @default(0) // 0-100%
  
  // Analysis
  trend       Trend?
  lastUpdate  DateTime?
  isAchievable Boolean?    // AI prediction
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, kpiType])
}

model BudgetScenario {
  id              String       @id @default(cuid())
  userId          String
  name            String
  description     String?
  scenarioType    ScenarioType @default(REALISTIC)
  
  // Budget parameters
  period          String       // "2024", "2024-Q1", etc.
  startDate       DateTime
  endDate         DateTime
  
  // Budget allocations
  categoryBudgets Json         // Budget by category
  totalBudget     Float
  contingency     Float        @default(0) // Emergency buffer
  
  // Performance tracking
  actualSpending  Float        @default(0)
  variance        Float        @default(0) // budget vs actual
  variancePercent Float        @default(0)
  
  // Analysis
  riskFactors     Json?        // Budget risks
  opportunities   Json?        // Savings opportunities
  recommendations Json?        // Budget optimization suggestions
  
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, scenarioType])
  @@index([userId, startDate])
}

// Enums
enum BusinessType {
  SMALL_BUSINESS
  CORPORATION
  LLC
  PARTNERSHIP
  SOLE_PROPRIETORSHIP
  NONPROFIT
}

enum CompanySize {
  MICRO          // 1-9 employees
  SMALL          // 10-49 employees  
  MEDIUM         // 50-249 employees
  LARGE          // 250+ employees
}

enum ForecastPeriod {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum ScenarioType {
  OPTIMISTIC
  REALISTIC
  PESSIMISTIC
  CUSTOM
}

enum TaxFilingStatus {
  SINGLE
  MARRIED_FILING_JOINTLY
  MARRIED_FILING_SEPARATELY
  HEAD_OF_HOUSEHOLD
  QUALIFYING_WIDOW
}

enum InsightType {
  FINANCIAL_RATIO
  TREND_ANALYSIS
  BENCHMARK_COMPARISON
  CASH_FLOW_PATTERN
  EXPENSE_PATTERN
  REVENUE_PATTERN
  DEBT_STATUS
  PROFITABILITY_METRIC
  EFFICIENCY_METRIC
  RISK_INDICATOR
  SEASONAL_PATTERN
  CUSTOMER_ANALYSIS
  VENDOR_ANALYSIS
  PROJECT_PERFORMANCE
}

enum InsightCategory {
  REVENUE
  EXPENSES
  PROFITABILITY
  CASH_FLOW
  DEBT_MANAGEMENT
  OPERATIONAL_EFFICIENCY
  MARKET_ANALYSIS
  CUSTOMER_INSIGHTS
  RISK_MANAGEMENT
  GROWTH_OPPORTUNITIES
}

enum Trend {
  UP
  DOWN
  STABLE
  VOLATILE
  SEASONAL
}

enum RecommendationType {
  COST_REDUCTION
  REVENUE_OPTIMIZATION
  DEBT_MANAGEMENT
  CASH_FLOW_IMPROVEMENT
  OPERATIONAL_EFFICIENCY
  STRATEGIC_PLANNING
  RISK_MITIGATION
  TAX_OPTIMIZATION
  INVESTMENT_STRATEGY
  PROCESS_IMPROVEMENT
  CUSTOMER_RETENTION
  MARKET_EXPANSION
}

enum RecommendationCategory {
  FINANCIAL
  OPERATIONAL
  STRATEGIC
  TACTICAL
  COMPLIANCE
  TECHNOLOGY
  HUMAN_RESOURCES
  MARKETING
  SALES
}

enum ImpactLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum RecommendationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  REJECTED
  ON_HOLD
}

enum UrgencyLevel {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
}

enum ComplianceType {
  TAX_COMPLIANCE
  REGULATORY_COMPLIANCE
  INDUSTRY_STANDARDS
  FINANCIAL_REPORTING
  DATA_PRIVACY
  EMPLOYMENT_LAW
  ENVIRONMENTAL
  SAFETY_STANDARDS
  LICENSING
  CERTIFICATION
}

enum ComplianceStatus {
  COMPLIANT
  PARTIALLY_COMPLIANT
  NON_COMPLIANT
  PENDING
  UNDER_REVIEW
  EXPIRED
}

enum ComplianceFrequency {
  MONTHLY
  QUARTERLY
  SEMI_ANNUALLY
  ANNUALLY
  BI_ANNUALLY
  AS_NEEDED
}

enum CreditType {
  BUSINESS_LOAN
  LINE_OF_CREDIT
  EQUIPMENT_FINANCING
  WORKING_CAPITAL
  SBA_LOAN
  MERCHANT_CASH_ADVANCE
  BUSINESS_CREDIT_CARD
  INVOICE_FACTORING
  ASSET_BASED_LENDING
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  DECLINED
  CONDITIONAL_APPROVAL
  FUNDED
  CANCELLED
}

enum ModelType {
  CASH_FLOW_FORECAST
  REVENUE_PREDICTION
  EXPENSE_PREDICTION
  CUSTOMER_CHURN
  DEMAND_FORECASTING
  PRICE_OPTIMIZATION
  RISK_ASSESSMENT
  PROFITABILITY_ANALYSIS
  MARKET_ANALYSIS
  SEASONAL_ADJUSTMENT
}

enum EntityType {
  SOLE_PROPRIETORSHIP
  PARTNERSHIP
  LLC
  CORPORATION
  S_CORPORATION
  NON_PROFIT
  TRUST
  SUBSIDIARY
  BRANCH
}

enum WorkflowTrigger {
  INVOICE_CREATED
  PAYMENT_RECEIVED
  PAYMENT_OVERDUE
  EXPENSE_THRESHOLD
  REVENUE_MILESTONE
  CASH_FLOW_ALERT
  BUDGET_VARIANCE
  SCHEDULED
  MANUAL
  DATA_CHANGE
  COMPLIANCE_DUE
  PROJECT_MILESTONE
}

enum KPIType {
  REVENUE
  PROFIT_MARGIN
  CASH_FLOW
  CUSTOMER_ACQUISITION
  CUSTOMER_RETENTION
  OPERATIONAL_EFFICIENCY
  DEBT_TO_EQUITY
  CURRENT_RATIO
  ROI
  ROE
  WORKING_CAPITAL
  INVENTORY_TURNOVER
  ACCOUNTS_RECEIVABLE
  ACCOUNTS_PAYABLE
  EMPLOYEE_PRODUCTIVITY
  MARKET_SHARE
}

enum TargetStatus {
  NOT_STARTED
  IN_PROGRESS
  ON_TRACK
  AT_RISK
  ACHIEVED
  EXCEEDED
  FAILED
}

enum RateType {
  HOURLY
  DAILY
  PROJECT
  MONTHLY
}

enum InvoiceStatus {
  DRAFT
  SENT
  VIEWED
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
}

enum EstimateStatus {
  DRAFT
  SENT
  VIEWED
  ACCEPTED
  DECLINED
  EXPIRED
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  COMPLETED
  CANCELLED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum DocumentCategory {
  CONTRACT
  INVOICE
  RECEIPT
  REPORT
  IMAGE
  SPREADSHEET
  PRESENTATION
  OTHER
}

enum BillStatus {
  PENDING
  SCHEDULED
  PAID
  OVERDUE
  CANCELLED
}

enum ExpenseClaimStatus {
  SUBMITTED
  APPROVED
  REJECTED
  PAID
}

enum AutomationTrigger {
  INVOICE_CREATED
  PAYMENT_RECEIVED
  BILL_DUE
  PROJECT_COMPLETED
  TASK_OVERDUE
  MONTHLY_REPORT
}

enum AutomationAction {
  SEND_EMAIL
  CREATE_TASK
  GENERATE_REPORT
  UPDATE_STATUS
  CREATE_INVOICE
  SEND_REMINDER
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum ReconciliationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  NEEDS_REVIEW
}

enum PaymentMethod {
  CASH
  CHECK
  BANK_TRANSFER
  CREDIT_CARD
  PAYPAL
  STRIPE
  OTHER
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER
}

enum CategoryType {
  INCOME
  EXPENSE
}

enum DebtType {
  CREDIT_CARD
  STUDENT_LOAN
  MORTGAGE
  PERSONAL_LOAN
  AUTO_LOAN
  OTHER
}

enum GoalType {
  EMERGENCY_FUND
  DEBT_PAYOFF
  SAVINGS
  INVESTMENT
  VACATION
  OTHER
}

enum BudgetType {
  MONTHLY
  WEEKLY
  YEARLY
}

enum NotificationType {
  BILL_REMINDER
  BUDGET_ALERT
  GOAL_PROGRESS
  DEBT_REMINDER
  CSV_PROCESSED
  OTHER
}

enum UploadStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum StatementFileType {
  CSV
  PDF
}

enum StatementSourceType {
  BANK
  CREDIT_CARD
}

enum ProcessingStage {
  UPLOADED
  EXTRACTING_DATA
  CATEGORIZING_TRANSACTIONS
  ANALYZING_PATTERNS
  GENERATING_INSIGHTS
  DISTRIBUTING_DATA
  COMPLETED
  FAILED
}
