generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/cfo_budgeting_app/app/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                        String                     @id @default(cuid())
  name                      String?
  email                     String                     @unique
  emailVerified             DateTime?
  image                     String?
  password                  String?
  firstName                 String?
  lastName                  String?
  companyName               String?
  jobTitle                  String?
  phone                     String?
  address                   String?
  city                      String?
  state                     String?
  country                   String?
  zipCode                   String?
  businessType              BusinessType               @default(SMALL_BUSINESS)
  industry                  String?
  annualRevenue             Float?
  companySize               CompanySize                @default(SMALL)
  fiscalYearEnd             DateTime?
  currentBusinessProfileId  String?
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  aiRecommendations         AIRecommendation[]
  accounts                  Account[]
  automations               Automation[]
  bankStatements            BankStatement[]
  bills                     Bill[]
  boardMeetings             BoardMeeting[]
  boardMembers              BoardMember[]
  budgets                   Budget[]
  budgetScenarios           BudgetScenario[]
  businessEntities          BusinessEntity[]
  businessInsights          BusinessInsight[]
  businessProfiles          BusinessProfile[]
  cashFlows                 CashFlow[]
  cashFlowForecasts         CashFlowForecast[]
  cashForecasts             CashForecast[]
  cashPositions             CashPosition[]
  categories                Category[]
  chartOfAccounts           ChartOfAccount[]
  competitiveAnalyses       CompetitiveAnalysis[]
  complianceTracking        ComplianceTracking[]
  contractors               Contractor[]
  creditApplications        CreditApplication[]
  csvUploads                CsvUpload[]
  customReports             CustomReport[]
  customers                 Customer[]
  debts                     Debt[]
  documents                 Document[]
  employees                 Employee[]
  estimates                 Estimate[]
  expenseClaims             ExpenseClaim[]
  financialMetrics          FinancialMetrics[]
  goals                     Goal[]
  industryBenchmarks        IndustryBenchmark[]
  insurancePolicies         InsurancePolicy[]
  investments               Investment[]
  investmentTransactions    InvestmentTransaction[]
  investorUpdates           InvestorUpdate[]
  invoices                  Invoice[]
  journalEntries            JournalEntry[]
  kpiTargets                KPITarget[]
  marketData                MarketData[]
  multiCurrencyTransactions MultiCurrencyTransaction[]
  notifications             Notification[]
  portfolios                Portfolio[]
  predictiveModels          PredictiveModel[]
  products                  Product[]
  projects                  Project[]
  receipts                  Receipt[]
  reconciliations           Reconciliation[]
  recurringCharges          RecurringCharge[]
  riskAssessments           RiskAssessment[]
  scenarioAnalyses          ScenarioAnalysis[]
  services                  Service[]
  sessions                  Session[]
  shareholders              Shareholder[]
  tasks                     Task[]
  taxOptimizations          TaxOptimization[]
  transactions              Transaction[]
  bankAccounts              BankAccount[]
  creditCardAccounts        CreditCardAccount[]
  loanAccounts              LoanAccount[]
  homeEquityAccounts        HomeEquityAccount[]
  lineOfCreditAccounts      LineOfCreditAccount[]
  burnRateAnalyses          BurnRateAnalysis[]
  vendors                   Vendor[]
  workflowRules             WorkflowRule[]
  assets                    Asset[]
  liabilities               Liability[]
  netWorthSnapshots         NetWorthSnapshot[]
  subscriptions             Subscription[]
  taxDocuments              TaxDocument[]
  retirementAccounts        RetirementAccount[]
  householdMembers          HouseholdMember[]
  creditScores              CreditScore[]
  charitableGivings         CharitableGiving[]
  homeInventoryItems        HomeInventoryItem[]
  vehicles                  Vehicle[]
  educationSavings          EducationSavings[]
  healthcareExpenses        HealthcareExpense[]
  wishLists                 WishList[]
  merchantRules             MerchantRule[]
  transactionReviews        TransactionReview[]
  userCorrections           UserCorrection[]
  recurringPatterns         RecurringPattern[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Transaction {
  id                       String                    @id @default(cuid())
  userId                   String
  businessProfileId        String?
  date                     DateTime
  amount                   Float
  description              String
  merchant                 String?
  category                 String
  categoryId               String?
  vendorId                 String?
  type                     TransactionType
  account                  String?
  csvUploadId              String?
  bankStatementId          String?
  source                   String?
  metadata                 Json?
  isRecurring              Boolean                   @default(false)
  aiCategorized            Boolean                   @default(false)
  confidence               Float?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  multiCurrencyTransaction MultiCurrencyTransaction?
  bankStatement            BankStatement?            @relation(fields: [bankStatementId], references: [id])
  businessProfile          BusinessProfile?          @relation(fields: [businessProfileId], references: [id])
  categoryRelation         Category?                 @relation(fields: [categoryId], references: [id])
  csvUpload                CsvUpload?                @relation(fields: [csvUploadId], references: [id])
  user                     User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  vendor                   Vendor?                   @relation(fields: [vendorId], references: [id])

  @@index([userId, date])
  @@index([userId, category])
  @@index([userId, businessProfileId])
}

model Category {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  color             String        @default("#3B82F6")
  icon              String        @default("folder")
  budget            Float?
  type              CategoryType
  isDefault         Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions      Transaction[]

  @@unique([userId, businessProfileId, name])
  @@index([userId, businessProfileId])
}

model Debt {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  balance           Float
  interestRate      Float
  minimumPayment    Float
  dueDate           Int
  type              DebtType
  priority          Int           @default(0)
  isActive          Boolean       @default(true)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments          DebtPayment[]

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
}

model DebtPayment {
  id        String   @id @default(cuid())
  debtId    String
  amount    Float
  date      DateTime
  principal Float?
  interest  Float?
  createdAt DateTime @default(now())
  debt      Debt     @relation(fields: [debtId], references: [id], onDelete: Cascade)

  @@index([debtId, date])
}

model Goal {
  id                String    @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  description       String?
  targetAmount      Float
  currentAmount     Float     @default(0)
  targetDate        DateTime?
  type              GoalType
  priority          Int       @default(0)
  isCompleted       Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isCompleted])
  @@index([userId, businessProfileId])
}

model Budget {
  id                String     @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  month             Int
  year              Int
  amount            Float
  spent             Float      @default(0)
  category          String
  type              BudgetType
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, businessProfileId, category, month, year])
  @@index([userId, month, year])
  @@index([userId, businessProfileId])
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  isRead    Boolean          @default(false)
  isActive  Boolean          @default(true)
  dueDate   DateTime?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@index([userId, dueDate])
}

model CsvUpload {
  id               String        @id @default(cuid())
  userId           String
  fileName         String
  originalName     String
  cloudStoragePath String
  recordCount      Int           @default(0)
  processedCount   Int           @default(0)
  status           UploadStatus
  mappingConfig    Json?
  errorLog         String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  user             User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions     Transaction[]

  @@index([userId, status])
}

model BankStatement {
  id                    String              @id @default(cuid())
  userId                String
  businessProfileId     String?
  fileName              String
  originalName          String?
  cloudStoragePath      String?
  fileType              StatementFileType?
  fileSize              Int?
  sourceType            StatementSourceType @default(BANK)
  bankName              String?
  accountType           String?
  accountNumber         String?
  accountName           String?
  creditLimit           Float?
  statementPeriod       String?
  statementType         String?             // 'personal' or 'business'
  periodStart           DateTime?
  periodEnd             DateTime?
  beginningBalance      Float?
  endingBalance         Float?
  transactionCount      Int                 @default(0)
  status                UploadStatus        @default(PENDING)
  processingStage       ProcessingStage     @default(UPLOADED)
  recordCount           Int                 @default(0)
  processedCount        Int                 @default(0)
  errorLog              String?
  aiAnalysis            Json?
  extractedData         Json?
  parsedData            Json?
  mappingConfig         Json?
  validationResult      Json?               // Stores validation report
  validationConfidence  Float?              // Overall confidence score (0-1)
  flaggedIssues         Json?               // Array of flagged transactions/issues
  validatedAt           DateTime?           // When validation completed
  processedAt           DateTime?
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
  user                  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  businessProfile       BusinessProfile?    @relation(fields: [businessProfileId], references: [id], onDelete: Cascade)
  transactions          Transaction[]

  @@index([userId, status])
  @@index([businessProfileId])
  @@index([userId, processingStage])
  @@index([userId, sourceType])
}

model FinancialMetrics {
  id                  String   @id @default(cuid())
  userId              String
  businessProfileId String?   @unique
  monthlyIncome       Float?
  monthlyExpenses     Float?
  monthlyBurnRate     Float?
  totalDebt           Float?   @default(0)
  totalAssets         Float?   @default(0)
  netWorth            Float?
  emergencyFundGoal   Float?
  debtToIncomeRatio   Float?
  profitMargin        Float?
  workingCapital      Float?
  currentRatio        Float?
  quickRatio          Float?
  debtToEquityRatio   Float?
  returnOnAssets      Float?
  returnOnEquity      Float?
  grossMargin         Float?
  operatingMargin     Float?
  cashFlowFromOps     Float?
  freeCashFlow        Float?
  businessCreditScore Int?
  riskScore           Float?
  lastCalculated      DateTime @default(now())
  updatedAt           DateTime @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Customer {
  id        String     @id @default(cuid())
  userId    String
  businessProfileId String?
  name      String
  email     String?
  phone     String?
  address   String?
  city      String?
  state     String?
  country   String?
  zipCode   String?
  taxId     String?
  website   String?
  notes     String?
  isActive  Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  estimates Estimate[]
  invoices  Invoice[]
  projects  Project[]

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
}

model Vendor {
  id           String        @id @default(cuid())
  userId       String
  businessProfileId String?
  name         String
  email        String?
  phone        String?
  address      String?
  city         String?
  state        String?
  country      String?
  zipCode      String?
  taxId        String?
  website      String?
  notes        String?
  paymentTerms String?
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  bills        Bill[]
  expenses     Transaction[]
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
}

model Contractor {
  id        String    @id @default(cuid())
  userId    String
  businessProfileId String?
  name      String
  email     String?
  phone     String?
  address   String?
  city      String?
  state     String?
  country   String?
  zipCode   String?
  taxId     String?
  rate      Float?
  rateType  RateType  @default(HOURLY)
  specialty String?
  notes     String?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects  Project[]
  tasks     Task[]

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
}

model Product {
  id            String         @id @default(cuid())
  userId        String
  businessProfileId String?
  name          String
  description   String?
  sku           String?
  price         Float
  cost          Float?
  category      String?
  unit          String?
  taxable       Boolean        @default(true)
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  estimateItems EstimateItem[]
  invoiceItems  InvoiceItem[]
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
  @@index([userId, category])
}

model Service {
  id            String         @id @default(cuid())
  userId        String
  businessProfileId String?
  name          String
  description   String?
  rate          Float
  unit          String         @default("hour")
  category      String?
  taxable       Boolean        @default(true)
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  estimateItems EstimateItem[]
  invoiceItems  InvoiceItem[]
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
  @@index([userId, category])
}

model Invoice {
  id            String        @id @default(cuid())
  userId        String
  businessProfileId String?
  customerId    String
  invoiceNumber String        @unique
  title         String?
  description   String?
  issueDate     DateTime
  dueDate       DateTime
  subtotal      Float
  taxRate       Float         @default(0)
  taxAmount     Float         @default(0)
  total         Float
  amountPaid    Float         @default(0)
  status        InvoiceStatus @default(DRAFT)
  terms         String?
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  customer      Customer      @relation(fields: [customerId], references: [id], onDelete: Cascade)
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  items         InvoiceItem[]
  payments      Payment[]

  @@index([userId, status])
  @@index([userId, businessProfileId])
  @@index([userId, dueDate])
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  productId   String?
  serviceId   String?
  description String
  quantity    Float
  rate        Float
  amount      Float
  createdAt   DateTime @default(now())
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product     Product? @relation(fields: [productId], references: [id])
  service     Service? @relation(fields: [serviceId], references: [id])
}

model Estimate {
  id             String         @id @default(cuid())
  userId         String
  businessProfileId String?
  customerId     String
  estimateNumber String         @unique
  title          String?
  description    String?
  issueDate      DateTime
  expiryDate     DateTime?
  subtotal       Float
  taxRate        Float          @default(0)
  taxAmount      Float          @default(0)
  total          Float
  status         EstimateStatus @default(DRAFT)
  terms          String?
  notes          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  customer       Customer       @relation(fields: [customerId], references: [id], onDelete: Cascade)
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items          EstimateItem[]

  @@index([userId, status])
  @@index([userId, businessProfileId])
  @@index([userId, expiryDate])
}

model EstimateItem {
  id          String   @id @default(cuid())
  estimateId  String
  productId   String?
  serviceId   String?
  description String
  quantity    Float
  rate        Float
  amount      Float
  createdAt   DateTime @default(now())
  estimate    Estimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  product     Product? @relation(fields: [productId], references: [id])
  service     Service? @relation(fields: [serviceId], references: [id])
}

model Project {
  id           String        @id @default(cuid())
  userId       String
  businessProfileId String?
  customerId   String?
  contractorId String?
  name         String
  description  String?
  startDate    DateTime?
  endDate      DateTime?
  budget       Float?
  status       ProjectStatus @default(PLANNING)
  priority     Priority      @default(MEDIUM)
  notes        String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  documents    Document[]
  contractor   Contractor?   @relation(fields: [contractorId], references: [id])
  customer     Customer?     @relation(fields: [customerId], references: [id])
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  tasks        Task[]

  @@index([userId, status])
  @@index([userId, businessProfileId])
}

model Employee {
  id         String      @id @default(cuid())
  userId     String
  businessProfileId String?
  firstName  String
  lastName   String
  email      String
  phone      String?
  address    String?
  city       String?
  state      String?
  country    String?
  zipCode    String?
  ssn        String?
  hireDate   DateTime
  salary     Float?
  hourlyRate Float?
  jobTitle   String?
  department String?
  isActive   Boolean     @default(true)
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  paychecks  Paycheck[]
  timesheets Timesheet[]

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
}

model Paycheck {
  id             String   @id @default(cuid())
  employeeId     String
  payPeriodStart DateTime
  payPeriodEnd   DateTime
  grossPay       Float
  netPay         Float
  taxes          Float
  deductions     Float
  createdAt      DateTime @default(now())
  employee       Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model Timesheet {
  id          String   @id @default(cuid())
  employeeId  String
  date        DateTime
  hoursWorked Float
  description String?
  approved    Boolean  @default(false)
  createdAt   DateTime @default(now())
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model Task {
  id             String      @id @default(cuid())
  userId         String
  projectId      String?
  contractorId   String?
  title          String
  description    String?
  priority       Priority    @default(MEDIUM)
  status         TaskStatus  @default(TODO)
  dueDate        DateTime?
  completedAt    DateTime?
  estimatedHours Float?
  actualHours    Float?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  contractor     Contractor? @relation(fields: [contractorId], references: [id])
  project        Project?    @relation(fields: [projectId], references: [id])
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, dueDate])
}

model Document {
  id               String           @id @default(cuid())
  userId           String
  projectId        String?
  name             String
  description      String?
  fileName         String
  cloudStoragePath String
  fileSize         Int?
  mimeType         String?
  category         DocumentCategory @default(OTHER)
  isPublic         Boolean          @default(false)
  version          Int              @default(1)
  retentionPolicyEnabled Boolean     @default(false)
  retentionPolicyYears Int?
  retentionExpiry  DateTime?
  complianceCategory String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  project          Project?         @relation(fields: [projectId], references: [id])
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  versions         DocumentVersion[]
  shares           DocumentShare[]

  @@index([userId, category])
}

model DocumentVersion {
  id               String   @id @default(cuid())
  documentId       String
  version          Int
  fileName         String
  cloudStoragePath String
  fileSize         Int?
  changeDescription String?
  createdAt        DateTime @default(now())
  createdBy        String
  document         Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId, version])
}

model DocumentShare {
  id            String    @id @default(cuid())
  documentId    String
  sharedBy      String
  sharedWith    String?
  shareToken    String    @unique
  expiresAt     DateTime?
  maxDownloads  Int?
  downloadCount Int       @default(0)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  document      Document  @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([documentId])
  @@index([shareToken])
}

model Bill {
  id          String     @id @default(cuid())
  userId      String
  businessProfileId String?
  vendorId    String?
  billNumber  String?
  description String
  amount      Float
  dueDate     DateTime
  paidDate    DateTime?
  status      BillStatus @default(PENDING)
  category    String?
  notes       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  vendor      Vendor?    @relation(fields: [vendorId], references: [id])

  @@index([userId, status])
  @@index([userId, businessProfileId])
  @@index([userId, dueDate])
}

model ExpenseClaim {
  id          String             @id @default(cuid())
  userId      String
  title       String
  description String?
  amount      Float
  date        DateTime
  category    String?
  status      ExpenseClaimStatus @default(SUBMITTED)
  receiptPath String?
  notes       String?
  approvedAt  DateTime?
  paidAt      DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, date])
}

model Receipt {
  id               String   @id @default(cuid())
  userId           String
  vendor           String?
  amount           Float
  date             DateTime
  category         String?
  description      String?
  cloudStoragePath String?
  ocrText          String?
  ocrData          Json?
  aiAnalysis       Json?
  processed        Boolean  @default(false)
  confidence       Float?
  taxDeductible    Boolean  @default(false)
  businessExpense  Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([userId, processed])
  @@index([userId, taxDeductible])
}

model Automation {
  id          String            @id @default(cuid())
  userId      String
  name        String
  description String?
  trigger     AutomationTrigger
  action      AutomationAction
  conditions  Json?
  isActive    Boolean           @default(true)
  lastRun     DateTime?
  runCount    Int               @default(0)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
}

model ChartOfAccount {
  id             String             @id @default(cuid())
  userId         String
  businessProfileId String?
  code           String
  name           String
  type           AccountType
  parentId       String?
  description    String?
  balance        Float              @default(0)
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  parent         ChartOfAccount?    @relation("AccountHierarchy", fields: [parentId], references: [id])
  children       ChartOfAccount[]   @relation("AccountHierarchy")
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  journalEntries JournalEntryLine[]

  @@unique([userId, code])
  @@index([userId, type])
  @@index([userId, businessProfileId])
}

model JournalEntry {
  id          String             @id @default(cuid())
  userId      String
  businessProfileId String?
  entryNumber String
  date        DateTime
  description String
  reference   String?
  totalDebit  Float
  totalCredit Float
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  lines       JournalEntryLine[]

  @@unique([userId, entryNumber])
  @@index([userId, date])
  @@index([userId, businessProfileId])
}

model JournalEntryLine {
  id             String         @id @default(cuid())
  journalEntryId String
  accountId      String
  description    String?
  debitAmount    Float          @default(0)
  creditAmount   Float          @default(0)
  account        ChartOfAccount @relation(fields: [accountId], references: [id])
  journalEntry   JournalEntry   @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
}

model Reconciliation {
  id             String               @id @default(cuid())
  userId         String
  businessProfileId String?
  accountId      String?
  month          Int
  year           Int
  openingBalance Float
  closingBalance Float
  bankBalance    Float?
  status         ReconciliationStatus @default(PENDING)
  difference     Float                @default(0)
  notes          String?
  reconciledAt   DateTime?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user           User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, month, year])
  @@index([userId, status])
  @@index([userId, businessProfileId])
}

model Payment {
  id        String        @id @default(cuid())
  invoiceId String
  amount    Float
  date      DateTime
  method    PaymentMethod @default(BANK_TRANSFER)
  reference String?
  notes     String?
  createdAt DateTime      @default(now())
  invoice   Invoice       @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

model CashFlowForecast {
  id                String         @id @default(cuid())
  userId            String
  businessProfileId String?
  period            String
  periodType        ForecastPeriod
  startDate         DateTime
  endDate           DateTime
  projectedIncome   Float          @default(0)
  projectedExpenses Float          @default(0)
  projectedCashFlow Float          @default(0)
  openingBalance    Float          @default(0)
  closingBalance    Float          @default(0)
  confidence        Float          @default(0.5)
  scenarioType      ScenarioType   @default(REALISTIC)
  incomeBreakdown   Json?
  expenseBreakdown  Json?
  modelVersion      String?
  generatedAt       DateTime       @default(now())
  isActive          Boolean        @default(true)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, period, scenarioType])
  @@index([userId, startDate])
  @@index([userId, businessProfileId])
  @@index([userId, scenarioType])
}

model TaxOptimization {
  id                     String           @id @default(cuid())
  userId                 String
  taxYear                Int
  quarter                Int?
  estimatedTaxableIncome Float            @default(0)
  estimatedTaxLiability  Float            @default(0)
  currentTaxPaid         Float            @default(0)
  quarterlyEstimate      Float            @default(0)
  standardDeduction      Float            @default(0)
  itemizedDeductions     Json?
  businessDeductions     Json?
  availableCredits       Json?
  recommendations        Json?
  potentialSavings       Float            @default(0)
  implementationSteps    Json?
  documentsRequired      Json?
  deadlines              Json?
  filingStatus           TaxFilingStatus?
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  user                   User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, taxYear, quarter])
  @@index([userId, taxYear])
}

model BusinessInsight {
  id          String          @id @default(cuid())
  userId      String
  type        InsightType
  category    InsightCategory
  title       String
  description String
  value       Float?
  percentage  Float?
  trend       Trend?
  timeframe   String?
  context     Json?
  analysis    String?
  confidence  Float           @default(0.5)
  actionable  Boolean         @default(false)
  priority    Priority        @default(MEDIUM)
  suggestions Json?
  source      String?
  isStale     Boolean         @default(false)
  staleAt     DateTime?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type])
  @@index([userId, priority])
  @@index([userId, actionable])
}

model AIRecommendation {
  id               String                 @id @default(cuid())
  userId           String
  type             RecommendationType
  category         RecommendationCategory
  title            String
  description      String
  impactLevel      ImpactLevel
  potentialSavings Float?
  potentialRevenue Float?
  riskLevel        RiskLevel              @default(LOW)
  timeToImplement  String?
  steps            Json
  requirements     Json?
  resources        Json?
  status           RecommendationStatus   @default(PENDING)
  implementedAt    DateTime?
  rejectedAt       DateTime?
  rejectionReason  String?
  confidence       Float                  @default(0.5)
  dataSupporting   Json?
  priority         Priority               @default(MEDIUM)
  urgencyLevel     UrgencyLevel           @default(NORMAL)
  dueDate          DateTime?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  user             User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, priority])
  @@index([userId, urgencyLevel])
}

model ScenarioAnalysis {
  id                String       @id @default(cuid())
  userId            String
  name              String
  description       String?
  scenarioType      ScenarioType @default(REALISTIC)
  timeHorizon       String
  startDate         DateTime
  endDate           DateTime
  revenueGrowth     Float?
  expenseGrowth     Float?
  inflationRate     Float?
  customVariables   Json?
  projectedRevenue  Float?
  projectedExpenses Float?
  projectedProfit   Float?
  projectedCashFlow Float?
  breakEvenPoint    DateTime?
  riskFactors       Json?
  opportunities     Json?
  recommendations   Json?
  comparisonData    Json?
  isActive          Boolean      @default(true)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, scenarioType])
  @@index([userId, startDate])
}

model ComplianceTracking {
  id             String               @id @default(cuid())
  userId         String
  complianceType ComplianceType
  title          String
  description    String?
  requirements   Json
  regulations    Json?
  industry       String?
  status         ComplianceStatus     @default(PENDING)
  completedItems Json?
  pendingItems   Json?
  overdue        Boolean              @default(false)
  dueDate        DateTime?
  lastReviewDate DateTime?
  nextReviewDate DateTime?
  frequency      ComplianceFrequency?
  documents      Json?
  evidence       Json?
  notes          String?
  riskLevel      RiskLevel            @default(LOW)
  penalties      Json?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  user           User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, dueDate])
  @@index([userId, complianceType])
}

model RecurringCharge {
  id              String             @id @default(cuid())
  userId          String
  businessProfileId String?
  name            String
  description     String?
  amount          Float
  category        String
  frequency       RecurringFrequency @default(MONTHLY)
  nextDueDate     DateTime
  lastPaidDate    DateTime?
  vendor          String?
  billingCycle    Int                @default(1)
  reminderEnabled Boolean            @default(true)
  reminderDays    Int                @default(3)
  isActive        Boolean            @default(true)
  isPaused        Boolean            @default(false)
  pausedUntil     DateTime?
  annualAmount    Float
  taxDeductible   Boolean            @default(false)
  businessExpense Boolean            @default(true)
  notes           String?
  tags            Json?
  lastUpdated     DateTime           @updatedAt
  createdAt       DateTime           @default(now())
  autoPayEnabled  Boolean            @default(false)
  paymentMethod   String?
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([userId, businessProfileId])
  @@index([userId, nextDueDate])
  @@index([userId, category])
  @@index([userId, frequency])
}

model CreditApplication {
  id                 String            @id @default(cuid())
  userId             String
  type               CreditType
  lender             String?
  productName        String?
  requestedAmount    Float
  purpose            String
  termLength         Int?
  collateral         String?
  businessRevenue    Float?
  businessExpenses   Float?
  businessAge        Int?
  status             ApplicationStatus @default(DRAFT)
  applicationDate    DateTime?
  approvalDate       DateTime?
  decisionAmount     Float?
  interestRate       Float?
  requirements       Json?
  submittedDocs      Json?
  eligibilityScore   Float?
  recommendations    Json?
  alternativeOptions Json?
  notes              String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  user               User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, type])
}

model IndustryBenchmark {
  id              String      @id @default(cuid())
  userId          String
  industry        String
  companySize     CompanySize
  region          String?
  avgRevenue      Float?
  avgProfit       Float?
  avgExpenses     Float?
  avgProfitMargin Float?
  avgCurrentRatio Float?
  avgDebtToEquity Float?
  avgROA          Float?
  avgROE          Float?
  avgEmployees    Int?
  avgCustomers    Int?
  avgProjects     Int?
  revenueGrowth   Float?
  customerGrowth  Float?
  marketShare     Float?
  userPerformance Json?
  gaps            Json?
  strengths       Json?
  dataSource      String?
  dataDate        DateTime
  isActive        Boolean     @default(true)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, industry, companySize])
  @@index([userId, industry])
}

model PredictiveModel {
  id              String    @id @default(cuid())
  userId          String
  modelType       ModelType
  name            String
  description     String?
  features        Json
  parameters      Json
  algorithm       String?
  trainingData    Json?
  trainingPeriod  String?
  dataQuality     Float?
  accuracy        Float?
  precision       Float?
  recall          Float?
  lastTrained     DateTime?
  predictions     Json?
  confidenceLevel Float?
  version         String    @default("1.0")
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, modelType])
  @@index([userId, isActive])
}

model BusinessEntity {
  id                 String           @id @default(cuid())
  userId             String
  name               String
  type               EntityType
  registrationNumber String?
  taxId              String?
  registrationDate   DateTime?
  registrationState  String?
  address            String?
  city               String?
  state              String?
  country            String?
  zipCode            String?
  phone              String?
  email              String?
  annualRevenue      Float?
  employees          Int?
  fiscalYearEnd      DateTime?
  parentEntityId     String?
  isActive           Boolean          @default(true)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  parentEntity       BusinessEntity?  @relation("EntityHierarchy", fields: [parentEntityId], references: [id])
  childEntities      BusinessEntity[] @relation("EntityHierarchy")
  user               User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type])
  @@index([userId, isActive])
}

model BusinessProfile {
  id                        String                     @id @default(cuid())
  userId                    String
  name                      String
  type                      BusinessProfileType        @default(BUSINESS)
  description               String?
  industry                  String?
  icon                      String?
  color                     String?
  isDefault                 Boolean                    @default(false)
  isActive                  Boolean                    @default(true)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  user                      User                       @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions              Transaction[]
  bankStatements            BankStatement[]
  categories                Category[]
  budgets                   Budget[]
  goals                     Goal[]
  debts                     Debt[]
  bills                     Bill[]
  invoices                  Invoice[]
  estimates                 Estimate[]
  recurringCharges          RecurringCharge[]
  chartOfAccounts           ChartOfAccount[]
  journalEntries            JournalEntry[]
  reconciliations           Reconciliation[]
  customers                 Customer[]
  vendors                   Vendor[]
  contractors               Contractor[]
  employees                 Employee[]
  projects                  Project[]
  products                  Product[]
  services                  Service[]
  investments               Investment[]
  portfolios                Portfolio[]
  investmentTransactions    InvestmentTransaction[]
  cashFlowForecasts         CashFlowForecast[]
  financialMetrics          FinancialMetrics?
  assets                    Asset[]
  liabilities               Liability[]
  netWorthSnapshots         NetWorthSnapshot[]
  subscriptions             Subscription[]
  taxDocuments              TaxDocument[]
  retirementAccounts        RetirementAccount[]
  householdMembers          HouseholdMember[]
  creditScores              CreditScore[]
  charitableGivings         CharitableGiving[]
  homeInventoryItems        HomeInventoryItem[]
  vehicles                  Vehicle[]
  educationSavings          EducationSavings[]
  healthcareExpenses        HealthcareExpense[]
  wishLists                 WishList[]
  merchantRules             MerchantRule[]
  transactionReviews        TransactionReview[]
  userCorrections           UserCorrection[]
  recurringPatterns         RecurringPattern[]

  @@unique([userId, name])
  @@index([userId, type])
  @@index([userId, isActive])
}

model WorkflowRule {
  id           String          @id @default(cuid())
  userId       String
  name         String
  description  String?
  trigger      WorkflowTrigger
  conditions   Json
  actions      Json
  isActive     Boolean         @default(true)
  lastRun      DateTime?
  runCount     Int             @default(0)
  successCount Int             @default(0)
  schedule     String?
  nextRun      DateTime?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([userId, trigger])
}

model KPITarget {
  id           String       @id @default(cuid())
  userId       String
  name         String
  description  String?
  kpiType      KPIType
  targetValue  Float
  currentValue Float        @default(0)
  unit         String?
  period       String
  startDate    DateTime
  endDate      DateTime
  status       TargetStatus @default(IN_PROGRESS)
  progress     Float        @default(0)
  trend        Trend?
  lastUpdate   DateTime?
  isAchievable Boolean?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, status])
  @@index([userId, kpiType])
}

model BudgetScenario {
  id              String       @id @default(cuid())
  userId          String
  name            String
  description     String?
  scenarioType    ScenarioType @default(REALISTIC)
  period          String
  startDate       DateTime
  endDate         DateTime
  categoryBudgets Json
  totalBudget     Float
  contingency     Float        @default(0)
  actualSpending  Float        @default(0)
  variance        Float        @default(0)
  variancePercent Float        @default(0)
  riskFactors     Json?
  opportunities   Json?
  recommendations Json?
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, scenarioType])
  @@index([userId, startDate])
}

model Investment {
  id               String                  @id @default(cuid())
  userId           String
  businessProfileId String?
  name             String
  type             InvestmentType
  category         InvestmentCategory
  symbol           String?
  currentValue     Float
  originalCost     Float
  quantity         Float?
  pricePerShare    Float?
  currency         String                  @default("USD")
  totalReturn      Float?
  totalReturnPct   Float?
  annualizedReturn Float?
  beta             Float?
  dividendYield    Float?
  volatility       Float?
  maxDrawdown      Float?
  sharpeRatio      Float?
  purchaseDate     DateTime
  maturityDate     DateTime?
  lastUpdated      DateTime                @default(now())
  isActive         Boolean                 @default(true)
  targetAllocation Float?
  actualAllocation Float?
  benchmarkIndex   String?
  benchmarkReturn  Float?
  riskRating       RiskRating              @default(MEDIUM)
  sector           String?
  geography        String?
  action           InvestmentAction?
  targetPrice      Float?
  stopLoss         Float?
  notes            String?
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user             User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions     InvestmentTransaction[]
  portfolios       PortfolioInvestment[]

  @@index([userId, type])
  @@index([userId, businessProfileId])
  @@index([userId, category])
  @@index([userId, isActive])
}

model Portfolio {
  id                String                @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  description       String?
  type              PortfolioType         @default(GENERAL)
  totalValue        Float                 @default(0)
  totalCost         Float                 @default(0)
  totalReturn       Float                 @default(0)
  totalReturnPct    Float                 @default(0)
  expectedReturn    Float?
  volatility        Float?
  sharpeRatio       Float?
  beta              Float?
  equityTarget      Float?
  bondTarget        Float?
  cashTarget        Float?
  alternativeTarget Float?
  isActive          Boolean               @default(true)
  lastRebalanced    DateTime?
  nextRebalance     DateTime?
  baseCurrency      String                @default("USD")
  notes             String?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  investments       PortfolioInvestment[]
  rebalanceEvents   PortfolioRebalance[]

  @@index([userId, type])
  @@index([userId, businessProfileId])
  @@index([userId, isActive])
}

model PortfolioInvestment {
  id            String     @id @default(cuid())
  portfolioId   String
  investmentId  String
  allocation    Float
  targetWeight  Float?
  currentWeight Float?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  investment    Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)
  portfolio     Portfolio  @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@unique([portfolioId, investmentId])
}

model InvestmentTransaction {
  id              String                    @id @default(cuid())
  userId          String
  businessProfileId String?
  investmentId    String
  type            InvestmentTransactionType
  quantity        Float
  price           Float
  totalAmount     Float
  fees            Float                     @default(0)
  tax             Float                     @default(0)
  currency        String                    @default("USD")
  exchangeRate    Float?
  transactionDate DateTime
  settlementDate  DateTime?
  referenceId     String?
  notes           String?
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt
  investment      Investment                @relation(fields: [investmentId], references: [id], onDelete: Cascade)
  businessProfile BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user            User                      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, transactionDate])
  @@index([userId, businessProfileId])
  @@index([userId, type])
}

model PortfolioRebalance {
  id                      String    @id @default(cuid())
  portfolioId             String
  rebalanceDate           DateTime
  reason                  String?
  preRebalanceValue       Float
  preRebalanceAllocation  Json
  postRebalanceValue      Float
  postRebalanceAllocation Json
  actions                 Json
  totalCost               Float     @default(0)
  expectedImpact          String?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  portfolio               Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)

  @@index([portfolioId, rebalanceDate])
}

model Currency {
  id            String         @id @default(cuid())
  code          String         @unique
  name          String
  symbol        String
  decimals      Int            @default(2)
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  exchangeRates ExchangeRate[]
}

model ExchangeRate {
  id               String   @id @default(cuid())
  fromCurrency     String
  toCurrency       String
  rate             Float
  date             DateTime
  source           String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  fromCurrencyData Currency @relation(fields: [fromCurrency], references: [code])

  @@unique([fromCurrency, toCurrency, date])
  @@index([fromCurrency, toCurrency])
  @@index([date])
}

model MultiCurrencyTransaction {
  id               String      @id @default(cuid())
  userId           String
  transactionId    String      @unique
  originalAmount   Float
  originalCurrency String
  baseAmount       Float
  baseCurrency     String
  exchangeRate     Float
  exchangeRateDate DateTime
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  transaction      Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  user             User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, originalCurrency])
}

model CashPosition {
  id               String          @id @default(cuid())
  userId           String
  accountName      String
  accountType      CashAccountType
  bankName         String?
  currentBalance   Float
  availableBalance Float?
  currency         String          @default("USD")
  interestRate     Float?
  monthlyFees      Float?
  minimumBalance   Float?
  targetBalance    Float?
  sweepAccount     String?
  fdic             Boolean         @default(false)
  riskRating       RiskRating      @default(LOW)
  isActive         Boolean         @default(true)
  lastReconciled   DateTime?
  notes            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  cashFlows        CashFlow[]
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, accountType])
  @@index([userId, isActive])
}

model CashFlow {
  id             String              @id @default(cuid())
  userId         String
  cashPositionId String?
  amount         Float
  type           CashFlowType
  category       CashFlowCategory
  description    String
  date           DateTime
  isRecurring    Boolean             @default(false)
  frequency      RecurringFrequency?
  counterparty   String?
  reference      String?
  status         CashFlowStatus      @default(PROJECTED)
  confidence     Float?
  currency       String              @default("USD")
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  cashPosition   CashPosition?       @relation(fields: [cashPositionId], references: [id])
  user           User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type])
  @@index([userId, date])
  @@index([userId, status])
}

model CashForecast {
  id                String   @id @default(cuid())
  userId            String
  forecastDate      DateTime
  horizon           Int
  openingBalance    Float
  projectedInflows  Float
  projectedOutflows Float
  closingBalance    Float
  minimumBalance    Float?
  maximumBalance    Float?
  riskDays          Json?
  confidence        Float    @default(0.5)
  modelVersion      String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, forecastDate])
  @@index([userId, forecastDate])
}

model RiskAssessment {
  id             String         @id @default(cuid())
  userId         String
  name           String
  type           RiskType
  category       RiskCategory
  description    String
  probability    Float
  impact         Float
  riskScore      Float
  riskLevel      RiskLevel
  mitigationPlan String?
  mitigationCost Float?
  residualRisk   Float?
  status         RiskStatus     @default(IDENTIFIED)
  identifiedDate DateTime       @default(now())
  reviewDate     DateTime?
  nextReviewDate DateTime?
  owner          String?
  reviewer       String?
  evidence       Json?
  controls       Json?
  notes          String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  incidents      RiskIncident[]

  @@index([userId, type])
  @@index([userId, riskLevel])
  @@index([userId, status])
}

model RiskIncident {
  id                 String           @id @default(cuid())
  riskId             String
  title              String
  description        String
  incidentDate       DateTime
  discoveredDate     DateTime         @default(now())
  severity           IncidentSeverity
  actualImpact       Float?
  responseActions    Json?
  lessonsLearned     String?
  preventiveMeasures String?
  status             IncidentStatus   @default(OPEN)
  resolvedDate       DateTime?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  risk               RiskAssessment   @relation(fields: [riskId], references: [id], onDelete: Cascade)

  @@index([riskId, incidentDate])
  @@index([status])
}

model InsurancePolicy {
  id                String        @id @default(cuid())
  userId            String
  policyName        String
  policyNumber      String?
  insuranceProvider String
  type              InsuranceType
  coverageAmount    Float
  deductible        Float?
  premium           Float
  effectiveDate     DateTime
  expirationDate    DateTime
  autoRenewal       Boolean       @default(false)
  claimsHistory     Json?
  claimsCount       Int           @default(0)
  lastClaimDate     DateTime?
  riskCovered       Json?
  exclusions        Json?
  totalPaid         Float         @default(0)
  totalClaims       Float         @default(0)
  isActive          Boolean       @default(true)
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type])
  @@index([userId, expirationDate])
  @@index([userId, isActive])
}

model BoardMember {
  id               String                 @id @default(cuid())
  userId           String
  name             String
  email            String
  phone            String?
  position         String
  biography        String?
  expertise        Json?
  appointmentDate  DateTime
  termExpiry       DateTime?
  isActive         Boolean                @default(true)
  isIndependent    Boolean                @default(false)
  committees       Json?
  preferredContact String?
  timezone         String?
  notes            String?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  boardMeetings    BoardMeetingAttendee[]
  user             User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isActive])
  @@index([userId, position])
}

model BoardMeeting {
  id            String                 @id @default(cuid())
  userId        String
  title         String
  description   String?
  meetingDate   DateTime
  duration      Int?
  location      String?
  isVirtual     Boolean                @default(false)
  meetingLink   String?
  agenda        Json?
  materials     Json?
  presentations Json?
  minutes       String?
  decisions     Json?
  actionItems   Json?
  status        MeetingStatus          @default(SCHEDULED)
  completedAt   DateTime?
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  user          User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  attendees     BoardMeetingAttendee[]

  @@index([userId, meetingDate])
  @@index([userId, status])
}

model BoardMeetingAttendee {
  id            String           @id @default(cuid())
  meetingId     String
  boardMemberId String
  status        AttendanceStatus @default(INVITED)
  attendedAt    DateTime?
  leftAt        DateTime?
  comments      String?
  votes         Json?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  boardMember   BoardMember      @relation(fields: [boardMemberId], references: [id], onDelete: Cascade)
  meeting       BoardMeeting     @relation(fields: [meetingId], references: [id], onDelete: Cascade)

  @@unique([meetingId, boardMemberId])
}

model InvestorUpdate {
  id             String             @id @default(cuid())
  userId         String
  title          String
  content        String
  period         String
  updateType     InvestorUpdateType
  keyMetrics     Json
  highlights     Json?
  challenges     Json?
  outlook        String?
  nextMilestones Json?
  recipientList  Json
  sentAt         DateTime?
  openRate       Float?
  attachments    Json?
  status         UpdateStatus       @default(DRAFT)
  publishedAt    DateTime?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, period])
  @@index([userId, updateType])
  @@index([userId, status])
}

model Shareholder {
  id                String       @id @default(cuid())
  userId            String
  name              String
  email             String?
  phone             String?
  sharesOwned       Float
  shareClass        String?
  ownershipPct      Float
  investmentDate    DateTime?
  investmentAmount  Float?
  currentValue      Float?
  investorType      InvestorType
  isAccredited      Boolean      @default(false)
  preferredContact  String?
  communicationFreq String?
  isActive          Boolean      @default(true)
  notes             String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, investorType])
  @@index([userId, isActive])
}

model CustomReport {
  id             String             @id @default(cuid())
  userId         String
  name           String
  description    String?
  category       ReportCategory
  reportType     ReportType
  dataSource     Json
  filters        Json
  grouping       Json?
  sorting        Json?
  chartType      ChartType?
  visualization  Json?
  outputFormat   OutputFormat       @default(PDF)
  pageLayout     PageLayout         @default(PORTRAIT)
  isScheduled    Boolean            @default(false)
  schedule       Json?
  recipients     Json?
  lastGenerated  DateTime?
  nextGeneration DateTime?
  template       Json?
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  user           User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  generations    ReportGeneration[]

  @@index([userId, category])
  @@index([userId, reportType])
  @@index([userId, isActive])
}

model ReportGeneration {
  id               String           @id @default(cuid())
  reportId         String
  generatedAt      DateTime         @default(now())
  parameters       Json?
  cloudStoragePath String?
  fileSize         Int?
  pageCount        Int?
  status           GenerationStatus @default(PENDING)
  errorMessage     String?
  executionTime    Int?
  emailsSent       Int              @default(0)
  downloadCount    Int              @default(0)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  report           CustomReport     @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId, generatedAt])
  @@index([status])
}

model MarketData {
  id            String   @id @default(cuid())
  userId        String
  industry      String
  region        String?
  marketSize    Float?
  growthRate    Float?
  competitors   Json?
  marketShare   Json?
  economicData  Json?
  trends        Json?
  opportunities Json?
  threats       Json?
  dataSource    String?
  dataDate      DateTime
  confidence    Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, industry, region])
  @@index([userId, industry])
  @@index([dataDate])
}

model CompetitiveAnalysis {
  id               String      @id @default(cuid())
  userId           String
  competitorName   String
  industry         String
  description      String?
  website          String?
  employees        Int?
  foundedYear      Int?
  estimatedRevenue Float?
  fundingRaised    Float?
  valuation        Float?
  strengths        Json?
  weaknesses       Json?
  marketPosition   String?
  targetMarket     Json?
  products         Json?
  pricing          Json?
  features         Json?
  threatLevel      ThreatLevel @default(MEDIUM)
  competitiveGap   Json?
  recommendations  Json?
  lastUpdated      DateTime
  dataSource       String?
  isActive         Boolean     @default(true)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  user             User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, competitorName])
  @@index([userId, industry])
  @@index([userId, threatLevel])
}

enum BusinessType {
  SMALL_BUSINESS
  CORPORATION
  LLC
  PARTNERSHIP
  SOLE_PROPRIETORSHIP
  NONPROFIT
}

enum BusinessProfileType {
  PERSONAL
  BUSINESS
}

enum CompanySize {
  MICRO
  SMALL
  MEDIUM
  LARGE
}

enum ForecastPeriod {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum ScenarioType {
  OPTIMISTIC
  REALISTIC
  PESSIMISTIC
  CUSTOM
}

enum TaxFilingStatus {
  SINGLE
  MARRIED_FILING_JOINTLY
  MARRIED_FILING_SEPARATELY
  HEAD_OF_HOUSEHOLD
  QUALIFYING_WIDOW
}

enum InsightType {
  FINANCIAL_RATIO
  TREND_ANALYSIS
  BENCHMARK_COMPARISON
  CASH_FLOW_PATTERN
  EXPENSE_PATTERN
  REVENUE_PATTERN
  DEBT_STATUS
  PROFITABILITY_METRIC
  EFFICIENCY_METRIC
  RISK_INDICATOR
  SEASONAL_PATTERN
  CUSTOMER_ANALYSIS
  VENDOR_ANALYSIS
  PROJECT_PERFORMANCE
}

enum InsightCategory {
  REVENUE
  EXPENSES
  PROFITABILITY
  CASH_FLOW
  DEBT_MANAGEMENT
  OPERATIONAL_EFFICIENCY
  MARKET_ANALYSIS
  CUSTOMER_INSIGHTS
  RISK_MANAGEMENT
  GROWTH_OPPORTUNITIES
}

enum Trend {
  UP
  DOWN
  STABLE
  VOLATILE
  SEASONAL
}

enum RecommendationType {
  COST_REDUCTION
  REVENUE_OPTIMIZATION
  DEBT_MANAGEMENT
  CASH_FLOW_IMPROVEMENT
  OPERATIONAL_EFFICIENCY
  STRATEGIC_PLANNING
  RISK_MITIGATION
  TAX_OPTIMIZATION
  INVESTMENT_STRATEGY
  PROCESS_IMPROVEMENT
  CUSTOMER_RETENTION
  MARKET_EXPANSION
}

enum RecommendationCategory {
  FINANCIAL
  OPERATIONAL
  STRATEGIC
  TACTICAL
  COMPLIANCE
  TECHNOLOGY
  HUMAN_RESOURCES
  MARKETING
  SALES
}

enum ImpactLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum RecommendationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  REJECTED
  ON_HOLD
}

enum UrgencyLevel {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
}

enum ComplianceType {
  TAX_COMPLIANCE
  REGULATORY_COMPLIANCE
  INDUSTRY_STANDARDS
  FINANCIAL_REPORTING
  DATA_PRIVACY
  EMPLOYMENT_LAW
  ENVIRONMENTAL
  SAFETY_STANDARDS
  LICENSING
  CERTIFICATION
}

enum ComplianceStatus {
  COMPLIANT
  PARTIALLY_COMPLIANT
  NON_COMPLIANT
  PENDING
  UNDER_REVIEW
  EXPIRED
}

enum ComplianceFrequency {
  MONTHLY
  QUARTERLY
  SEMI_ANNUALLY
  ANNUALLY
  BI_ANNUALLY
  AS_NEEDED
}

enum RecurringFrequency {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  BIMONTHLY
  QUARTERLY
  SEMIANNUALLY
  ANNUALLY
  CUSTOM
}

enum CreditType {
  BUSINESS_LOAN
  LINE_OF_CREDIT
  EQUIPMENT_FINANCING
  WORKING_CAPITAL
  SBA_LOAN
  MERCHANT_CASH_ADVANCE
  BUSINESS_CREDIT_CARD
  INVOICE_FACTORING
  ASSET_BASED_LENDING
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  DECLINED
  CONDITIONAL_APPROVAL
  FUNDED
  CANCELLED
}

enum ModelType {
  CASH_FLOW_FORECAST
  REVENUE_PREDICTION
  EXPENSE_PREDICTION
  CUSTOMER_CHURN
  DEMAND_FORECASTING
  PRICE_OPTIMIZATION
  RISK_ASSESSMENT
  PROFITABILITY_ANALYSIS
  MARKET_ANALYSIS
  SEASONAL_ADJUSTMENT
}

enum EntityType {
  SOLE_PROPRIETORSHIP
  PARTNERSHIP
  LLC
  CORPORATION
  S_CORPORATION
  NON_PROFIT
  TRUST
  SUBSIDIARY
  BRANCH
}

enum WorkflowTrigger {
  INVOICE_CREATED
  PAYMENT_RECEIVED
  PAYMENT_OVERDUE
  EXPENSE_THRESHOLD
  REVENUE_MILESTONE
  CASH_FLOW_ALERT
  BUDGET_VARIANCE
  SCHEDULED
  MANUAL
  DATA_CHANGE
  COMPLIANCE_DUE
  PROJECT_MILESTONE
}

enum KPIType {
  REVENUE
  PROFIT_MARGIN
  CASH_FLOW
  CUSTOMER_ACQUISITION
  CUSTOMER_RETENTION
  OPERATIONAL_EFFICIENCY
  DEBT_TO_EQUITY
  CURRENT_RATIO
  ROI
  ROE
  WORKING_CAPITAL
  INVENTORY_TURNOVER
  ACCOUNTS_RECEIVABLE
  ACCOUNTS_PAYABLE
  EMPLOYEE_PRODUCTIVITY
  MARKET_SHARE
}

enum TargetStatus {
  NOT_STARTED
  IN_PROGRESS
  ON_TRACK
  AT_RISK
  ACHIEVED
  EXCEEDED
  FAILED
}

enum RateType {
  HOURLY
  DAILY
  PROJECT
  MONTHLY
}

enum InvoiceStatus {
  DRAFT
  SENT
  VIEWED
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
}

enum EstimateStatus {
  DRAFT
  SENT
  VIEWED
  ACCEPTED
  DECLINED
  EXPIRED
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  COMPLETED
  CANCELLED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum DocumentCategory {
  CONTRACT
  INVOICE
  RECEIPT
  REPORT
  IMAGE
  SPREADSHEET
  PRESENTATION
  OTHER
}

enum BillStatus {
  PENDING
  SCHEDULED
  PAID
  OVERDUE
  CANCELLED
}

enum ExpenseClaimStatus {
  SUBMITTED
  APPROVED
  REJECTED
  PAID
}

enum AutomationTrigger {
  INVOICE_CREATED
  PAYMENT_RECEIVED
  BILL_DUE
  PROJECT_COMPLETED
  TASK_OVERDUE
  MONTHLY_REPORT
}

enum AutomationAction {
  SEND_EMAIL
  CREATE_TASK
  GENERATE_REPORT
  UPDATE_STATUS
  CREATE_INVOICE
  SEND_REMINDER
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum ReconciliationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  NEEDS_REVIEW
}

enum PaymentMethod {
  CASH
  CHECK
  BANK_TRANSFER
  CREDIT_CARD
  PAYPAL
  STRIPE
  OTHER
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER
}

enum CategoryType {
  INCOME
  EXPENSE
}

enum DebtType {
  CREDIT_CARD
  STUDENT_LOAN
  MORTGAGE
  PERSONAL_LOAN
  AUTO_LOAN
  OTHER
}

enum GoalType {
  EMERGENCY_FUND
  DEBT_PAYOFF
  SAVINGS
  INVESTMENT
  VACATION
  OTHER
}

enum BudgetType {
  MONTHLY
  WEEKLY
  YEARLY
}

enum NotificationType {
  BILL_REMINDER
  BUDGET_ALERT
  GOAL_PROGRESS
  DEBT_REMINDER
  CSV_PROCESSED
  OTHER
}

enum UploadStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum StatementFileType {
  CSV
  PDF
}

enum StatementSourceType {
  BANK
  CREDIT_CARD
}

enum ProcessingStage {
  UPLOADED
  QUEUED
  EXTRACTING_DATA
  CATEGORIZING_TRANSACTIONS
  ANALYZING_PATTERNS
  GENERATING_INSIGHTS
  DISTRIBUTING_DATA
  VALIDATING
  COMPLETED
  FAILED
}

enum InvestmentType {
  STOCK
  BOND
  MUTUAL_FUND
  ETF
  REAL_ESTATE
  COMMODITIES
  CRYPTOCURRENCY
  PRIVATE_EQUITY
  VENTURE_CAPITAL
  ALTERNATIVE
  CASH
  CD
  TREASURY
  CORPORATE_BOND
  MUNICIPAL_BOND
  OPTIONS
  FUTURES
  FOREX
}

enum InvestmentCategory {
  GROWTH
  VALUE
  DIVIDEND
  INCOME
  SPECULATION
  HEDGE
  CORE_HOLDING
  SATELLITE
  TACTICAL
}

enum InvestmentAction {
  BUY
  SELL
  HOLD
  REBALANCE
  REDUCE
  INCREASE
}

enum PortfolioType {
  GENERAL
  RETIREMENT
  TAXABLE
  TAX_DEFERRED
  HEDGE_FUND
  PRIVATE_EQUITY
  REAL_ESTATE
  COMMODITIES
  EMERGENCY_FUND
}

enum InvestmentTransactionType {
  BUY
  SELL
  DIVIDEND
  INTEREST
  SPLIT
  MERGER
  SPINOFF
  DEPOSIT
  WITHDRAWAL
  FEE
  TAX
  REINVESTMENT
}

enum CashAccountType {
  CHECKING
  SAVINGS
  MONEY_MARKET
  CD
  TREASURY
  SWEEP
  ESCROW
  OPERATING
  INVESTMENT
}

enum CashFlowType {
  INFLOW
  OUTFLOW
}

enum CashFlowCategory {
  OPERATIONS
  INVESTING
  FINANCING
  TAX
  DIVIDEND
  INTEREST
  PAYROLL
  SUPPLIER
  CUSTOMER
  LOAN
  OTHER
}

enum CashFlowStatus {
  PROJECTED
  CONFIRMED
  ACTUAL
  CANCELLED
}

enum RiskType {
  FINANCIAL
  OPERATIONAL
  STRATEGIC
  COMPLIANCE
  REPUTATIONAL
  TECHNOLOGY
  MARKET
  CREDIT
  LIQUIDITY
  INTEREST_RATE
  CURRENCY
  CYBERSECURITY
}

enum RiskCategory {
  HIGH_LEVEL
  PROCESS_LEVEL
  TRANSACTION_LEVEL
  SYSTEM_LEVEL
}

enum RiskStatus {
  IDENTIFIED
  ASSESSED
  MITIGATED
  MONITORED
  CLOSED
  ESCALATED
}

enum RiskRating {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IncidentSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum IncidentStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum InsuranceType {
  GENERAL_LIABILITY
  PROFESSIONAL_LIABILITY
  PROPERTY
  AUTO
  WORKERS_COMP
  DIRECTORS_OFFICERS
  CYBER_LIABILITY
  BUSINESS_INTERRUPTION
  KEY_PERSON
  HEALTH
  DISABILITY
}

enum MeetingStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  POSTPONED
}

enum AttendanceStatus {
  INVITED
  ACCEPTED
  DECLINED
  ATTENDED
  ABSENT
}

enum InvestorUpdateType {
  MONTHLY
  QUARTERLY
  ANNUAL
  MILESTONE
  FUNDRAISING
  EXIT
  SPECIAL
}

enum UpdateStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum InvestorType {
  FOUNDER
  EMPLOYEE
  ANGEL
  VC
  PE
  STRATEGIC
  FAMILY_OFFICE
  FUND
  INDIVIDUAL
  INSTITUTIONAL
}

enum ReportCategory {
  FINANCIAL
  OPERATIONAL
  STRATEGIC
  COMPLIANCE
  INVESTOR
  BOARD
  CUSTOM
}

enum ReportType {
  INCOME_STATEMENT
  BALANCE_SHEET
  CASH_FLOW
  BUDGET_VARIANCE
  KPI_DASHBOARD
  INVESTOR_DECK
  BOARD_PACKAGE
  COMPLIANCE_REPORT
  CUSTOM_ANALYSIS
}

enum ChartType {
  BAR
  LINE
  PIE
  DONUT
  AREA
  SCATTER
  RADAR
  GAUGE
  TABLE
  HEATMAP
}

enum OutputFormat {
  PDF
  EXCEL
  CSV
  POWERPOINT
  HTML
  EMAIL
}

enum PageLayout {
  PORTRAIT
  LANDSCAPE
}

enum GenerationStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum ThreatLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// Net Worth Tracker Models
model Asset {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  type              AssetType
  value             Float
  description       String?
  purchaseDate      DateTime?
  purchasePrice     Float?
  appreciationRate  Float?
  category          String?
  location          String?
  notes             String?
  isLiquid          Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
  @@index([userId, type])
}

model Liability {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  type              LiabilityType
  balance           Float
  interestRate      Float?
  minimumPayment    Float?
  dueDate           DateTime?
  originalAmount    Float?
  lender            String?
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
  @@index([userId, type])
}

model NetWorthSnapshot {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  date              DateTime
  totalAssets       Float
  totalLiabilities  Float
  netWorth          Float
  assetBreakdown    Json?
  liabilityBreakdown Json?
  changeFromPrevious Float?
  percentageChange  Float?
  notes             String?
  createdAt         DateTime      @default(now())
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId, date])
}

// Subscription Management
model Subscription {
  id                String             @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  description       String?
  amount            Float
  category          String
  provider          String?
  frequency         RecurringFrequency @default(MONTHLY)
  nextBillingDate   DateTime
  lastBillingDate   DateTime?
  status            SubscriptionStatus @default(ACTIVE)
  paymentMethod     String?
  cancellationDate  DateTime?
  reminderEnabled   Boolean            @default(true)
  reminderDays      Int                @default(3)
  autoRenew         Boolean            @default(true)
  trialEndDate      DateTime?
  contractEndDate   DateTime?
  annualCost        Float
  website           String?
  loginEmail        String?
  notes             String?
  tags              Json?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
  @@index([userId, status])
  @@index([userId, nextBillingDate])
}

// Bill Calendar already handled by existing Bill model + enhancements

// Emergency Fund Tracker (using enhanced Goal model with specific type)

// Tax Documents & Planning
model TaxDocument {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  description       String?
  taxYear           Int
  documentType      TaxDocumentType
  category          TaxDocumentCategory
  cloudStoragePath  String
  fileName          String
  fileSize          Int?
  uploadDate        DateTime      @default(now())
  isDeductible      Boolean       @default(false)
  deductionAmount   Float?
  notes             String?
  tags              Json?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
  @@index([userId, taxYear])
  @@index([userId, documentType])
}

// Insurance Manager (InsurancePolicy already exists, but let's enhance it)

// Retirement Planning
model RetirementAccount {
  id                String             @id @default(cuid())
  userId            String
  businessProfileId String?
  accountName       String
  accountType       RetirementAccountType
  provider          String?
  accountNumber     String?
  currentBalance    Float
  contributionLimit Float?
  annualContribution Float?
  employerMatch     Float?
  vestingPercentage Float?
  targetBalance     Float?
  retirementAge     Int?
  riskProfile       String?
  assetAllocation   Json?
  performanceYTD    Float?
  notes             String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  contributions     RetirementContribution[]

  @@index([userId, businessProfileId])
  @@index([userId, accountType])
}

model RetirementContribution {
  id                  String            @id @default(cuid())
  retirementAccountId String
  date                DateTime
  amount              Float
  contributionType    ContributionType
  notes               String?
  createdAt           DateTime          @default(now())
  retirementAccount   RetirementAccount @relation(fields: [retirementAccountId], references: [id], onDelete: Cascade)

  @@index([retirementAccountId, date])
}

// Receipt Manager (Receipt model already exists)

// Cash Flow Forecast (CashFlowForecast already exists)

// Family/Household Members
model HouseholdMember {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  firstName         String
  lastName          String
  relationship      String
  birthDate         DateTime?
  dependentStatus   Boolean       @default(false)
  isActive          Boolean       @default(true)
  email             String?
  phone             String?
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
}

// Financial Reports (generated from existing data)

// Credit Score Monitoring
model CreditScore {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  score             Int
  provider          String?
  scoreDate         DateTime
  scoreType         CreditScoreType @default(FICO)
  factors           Json?
  accounts          Int?
  inquiries         Int?
  derogatory        Int?
  avgAccountAge     Int?
  creditUtilization Float?
  totalDebt         Float?
  paymentHistory    Float?
  notes             String?
  createdAt         DateTime      @default(now())
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId, scoreDate])
}

// Charitable Giving Tracker
model CharitableGiving {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  organizationName  String
  amount            Float
  date              DateTime
  donationType      DonationType
  taxDeductible     Boolean       @default(true)
  receiptNumber     String?
  cloudStoragePath  String?
  category          String?
  recurring         Boolean       @default(false)
  frequency         RecurringFrequency?
  nextDonationDate  DateTime?
  taxYear           Int
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
  @@index([userId, taxYear])
  @@index([userId, date])
}

// Home Inventory
model HomeInventoryItem {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  description       String?
  category          HomeInventoryCategory
  purchaseDate      DateTime?
  purchasePrice     Float?
  currentValue      Float?
  location          String?
  brand             String?
  model             String?
  serialNumber      String?
  warrantyExpiration DateTime?
  cloudStoragePath  String?
  receiptPath       String?
  notes             String?
  tags              Json?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
  @@index([userId, category])
}

// Vehicle Expenses
model Vehicle {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  make              String
  model             String
  year              Int
  vin               String?
  licensePlate      String?
  purchaseDate      DateTime?
  purchasePrice     Float?
  currentValue      Float?
  mileage           Int?
  color             String?
  fuelType          String?
  insurancePolicy   String?
  registrationExpiry DateTime?
  inspectionExpiry  DateTime?
  notes             String?
  isActive          Boolean       @default(true)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  expenses          VehicleExpense[]

  @@index([userId, businessProfileId])
  @@index([userId, isActive])
}

model VehicleExpense {
  id                String        @id @default(cuid())
  vehicleId         String
  date              DateTime
  type              VehicleExpenseType
  amount            Float
  mileage           Int?
  vendor            String?
  description       String?
  receiptPath       String?
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  vehicle           Vehicle       @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([vehicleId, date])
  @@index([vehicleId, type])
}

// Education Savings
model EducationSavings {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  beneficiaryName   String
  accountType       EducationAccountType
  provider          String?
  accountNumber     String?
  currentBalance    Float
  targetAmount      Float?
  targetDate        DateTime?
  annualContribution Float?
  stateSponsored    Boolean       @default(false)
  taxBenefits       Json?
  investmentOptions Json?
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  contributions     EducationContribution[]

  @@index([userId, businessProfileId])
  @@index([userId, accountType])
}

model EducationContribution {
  id                  String            @id @default(cuid())
  educationSavingsId  String
  date                DateTime
  amount              Float
  contributionType    ContributionType
  notes               String?
  createdAt           DateTime          @default(now())
  educationSavings    EducationSavings  @relation(fields: [educationSavingsId], references: [id], onDelete: Cascade)

  @@index([educationSavingsId, date])
}

// Healthcare Expenses
model HealthcareExpense {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  date              DateTime
  provider          String
  type              HealthcareExpenseType
  amount            Float
  insuranceCovered  Float?
  outOfPocket       Float
  description       String?
  diagnosis         String?
  prescription      String?
  receiptPath       String?
  claimNumber       String?
  claimStatus       String?
  taxDeductible     Boolean       @default(true)
  hsaEligible       Boolean       @default(false)
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, businessProfileId])
  @@index([userId, date])
  @@index([userId, type])
}

// Shopping Lists/Wish Lists
model WishList {
  id                String        @id @default(cuid())
  userId            String
  businessProfileId String?
  name              String
  description       String?
  category          String?
  priority          Priority      @default(MEDIUM)
  targetAmount      Float?
  savedAmount       Float         @default(0)
  targetDate        DateTime?
  isActive          Boolean       @default(true)
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  items             WishListItem[]

  @@index([userId, businessProfileId])
  @@index([userId, isActive])
}

model WishListItem {
  id                String        @id @default(cuid())
  wishListId        String
  name              String
  description       String?
  estimatedCost     Float
  url               String?
  imageUrl          String?
  priority          Priority      @default(MEDIUM)
  isPurchased       Boolean       @default(false)
  purchasedDate     DateTime?
  actualCost        Float?
  notes             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  wishList          WishList      @relation(fields: [wishListId], references: [id], onDelete: Cascade)

  @@index([wishListId, isPurchased])
}

// Enums for new models
enum AssetType {
  REAL_ESTATE
  VEHICLE
  INVESTMENT
  BANK_ACCOUNT
  RETIREMENT
  CASH
  JEWELRY
  ART
  BUSINESS
  OTHER
}

enum LiabilityType {
  MORTGAGE
  AUTO_LOAN
  STUDENT_LOAN
  CREDIT_CARD
  PERSONAL_LOAN
  BUSINESS_LOAN
  MEDICAL_DEBT
  TAX_DEBT
  OTHER
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  PAUSED
  TRIAL
  EXPIRED
}

enum TaxDocumentType {
  W2
  W4
  FORM_1099
  FORM_1040
  SCHEDULE_C
  SCHEDULE_E
  CHARITABLE_RECEIPT
  RECEIPT
  INVOICE
  BANK_STATEMENT
  INVESTMENT_STATEMENT
  PROPERTY_TAX
  OTHER
}

enum TaxDocumentCategory {
  INCOME
  DEDUCTION
  CREDIT
  PAYMENT
  WITHHOLDING
  ESTIMATED_TAX
  OTHER
}

enum RetirementAccountType {
  TRADITIONAL_401K
  ROTH_401K
  TRADITIONAL_IRA
  ROTH_IRA
  SEP_IRA
  SIMPLE_IRA
  PENSION
  ANNUITY
  OTHER
}

enum ContributionType {
  EMPLOYEE
  EMPLOYER
  ROLLOVER
  CONVERSION
  OTHER
}

enum CreditScoreType {
  FICO
  VANTAGE
  EQUIFAX
  EXPERIAN
  TRANSUNION
  OTHER
}

enum DonationType {
  CASH
  CHECK
  CREDIT_CARD
  STOCK
  PROPERTY
  GOODS
  OTHER
}

enum HomeInventoryCategory {
  ELECTRONICS
  FURNITURE
  APPLIANCES
  JEWELRY
  ART
  COLLECTIBLES
  TOOLS
  SPORTING_GOODS
  CLOTHING
  BOOKS
  KITCHEN
  OUTDOOR
  OTHER
}

enum VehicleExpenseType {
  GAS
  MAINTENANCE
  REPAIR
  INSURANCE
  REGISTRATION
  INSPECTION
  PARKING
  TOLLS
  CAR_WASH
  ACCESSORIES
  OTHER
}

enum EducationAccountType {
  PLAN_529
  COVERDELL_ESA
  UGMA
  UTMA
  SAVINGS_ACCOUNT
  INVESTMENT_ACCOUNT
  OTHER
}

enum HealthcareExpenseType {
  DOCTOR_VISIT
  SPECIALIST
  HOSPITAL
  SURGERY
  PRESCRIPTION
  DENTAL
  VISION
  THERAPY
  MEDICAL_EQUIPMENT
  INSURANCE_PREMIUM
  LAB_WORK
  IMAGING
  OTHER
}


// Burn Rate & Financial Outlook Models
model BankAccount {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?
  accountName       String
  accountNumber     String?
  bankName          String
  accountType       String           // Checking, Savings, Money Market, etc.
  currentBalance    Float
  currency          String           @default("USD")
  isActive          Boolean          @default(true)
  lastUpdated       DateTime         @default(now())
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CreditCardAccount {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?
  cardName          String
  lastFourDigits    String?
  issuer            String
  creditLimit       Float
  currentBalance    Float
  availableCredit   Float
  interestRate      Float?
  minimumPayment    Float?
  paymentDueDate    DateTime?
  isActive          Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LoanAccount {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?
  loanName          String
  loanType          String           // Business Loan, Personal Loan, Auto Loan, Equipment Loan, etc.
  lender            String
  originalAmount    Float
  currentBalance    Float
  interestRate      Float
  monthlyPayment    Float
  remainingMonths   Int?
  paymentDueDate    DateTime?
  isActive          Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model HomeEquityAccount {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?
  accountName       String
  lender            String
  propertyValue     Float
  mortgageBalance   Float
  availableEquity   Float
  creditLimit       Float?
  currentBalance    Float            @default(0)
  interestRate      Float?
  isActive          Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LineOfCreditAccount {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?
  accountName       String
  lender            String
  creditLimit       Float
  currentBalance    Float
  availableCredit   Float
  interestRate      Float?
  minimumPayment    Float?
  paymentDueDate    DateTime?
  isActive          Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model BurnRateAnalysis {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?
  analysisDate      DateTime         @default(now())
  totalCash         Float
  totalCredit       Float
  totalDebt         Float
  monthlyExpenses   Float
  monthlyRevenue    Float
  burnRate          Float
  runwayMonths      Float?
  recommendations   Json             // AI-generated recommendations
  riskLevel         String           // LOW, MEDIUM, HIGH, CRITICAL
  actionItems       Json             // Specific action items
  createdAt         DateTime         @default(now())
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model FinancialReport {
  id                String           @id @default(cuid())
  userId            String?
  businessProfileId String?
  name              String
  type              String
  startDate         DateTime
  endDate           DateTime
  summary           Json             // Contains income, expenses, netIncome, transactionCount
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
}

// ====================================
// 100% ACCURACY SYSTEM - NEW MODELS
// ====================================

// User-defined merchant rules for automatic routing
model MerchantRule {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?          // Which profile to route to
  merchantName      String           // Merchant name or pattern
  merchantPattern   String?          // Regex pattern for matching (optional)
  suggestedCategory String           // Category to assign
  profileType       String           // BUSINESS or PERSONAL
  priority          Int              @default(0) // Higher priority rules applied first
  isActive          Boolean          @default(true)
  autoApply         Boolean          @default(true) // Automatically apply without review
  appliedCount      Int              @default(0)    // Track how many times this rule was used
  lastApplied       DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])

  @@index([userId, merchantName])
  @@index([userId, isActive])
}

// Queue for manual review of low-confidence transactions
model TransactionReview {
  id                String           @id @default(cuid())
  userId            String
  transactionId     String           // Reference to Transaction
  businessProfileId String?
  status            String           @default("PENDING") // PENDING, APPROVED, REJECTED, CORRECTED
  confidence        Float            // AI confidence score
  aiSuggestion      Json             // AI's suggested category/profile/etc
  userCorrection    Json?            // User's correction (if any)
  issueType         String?          // LOW_CONFIDENCE, CATEGORY_MISMATCH, PROFILE_MISMATCH, etc
  issueSeverity     String?          // LOW, MEDIUM, HIGH
  issueDescription  String?
  suggestedFix      String?
  reviewedAt        DateTime?
  reviewedBy        String?          // User ID who reviewed
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])

  @@index([userId, status])
  @@index([userId, transactionId])
}

// Learning system - tracks user corrections for future improvements
model UserCorrection {
  id                String           @id @default(cuid())
  userId            String
  transactionId     String           // Original transaction
  businessProfileId String?
  correctionType    String           // CATEGORY, PROFILE, MERCHANT, AMOUNT, DATE
  originalValue     String           // What AI suggested
  correctedValue    String           // What user corrected to
  merchantName      String?          // For pattern learning
  merchantPattern   String?          // Extracted pattern
  confidence        Float?           // How confident the AI was
  appliedAsRule     Boolean          @default(false) // Was this converted to a merchant rule?
  ruleId            String?          // If converted to rule, store rule ID
  createdAt         DateTime         @default(now())
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])

  @@index([userId, merchantName])
  @@index([userId, correctionType])
  @@index([userId, createdAt])
}

// Detected recurring patterns across statements
model RecurringPattern {
  id                String           @id @default(cuid())
  userId            String
  businessProfileId String?
  merchantName      String
  category          String
  profileType       String           // BUSINESS or PERSONAL
  averageAmount     Float
  frequency         String           // WEEKLY, MONTHLY, QUARTERLY, ANNUALLY
  detectedFrom      Int              @default(1) // Number of occurrences detected
  lastOccurrence    DateTime
  nextExpected      DateTime?
  confidence        Float            @default(0.8)
  isActive          Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  businessProfile   BusinessProfile? @relation(fields: [businessProfileId], references: [id])

  @@unique([userId, merchantName, businessProfileId])
  @@index([userId, isActive])
}
